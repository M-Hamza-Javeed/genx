<div id="page0" style="position:relative;width:540pt;height:648pt;background-color:white">
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:32pt;left:218pt"><span style="font-family:Times,serif;font-size:9.963pt">Chapter 8. Minilanguages</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:100pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">The main difference is how carefully marked the boundaries of transactions are. Human beings are</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:112pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">good at spotting where conversational output from a CLI ends, and where the prompt for the next</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:124pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">input is.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:124pt;left:114pt"><span style="font-family:Times,serif;font-size:9.963pt">They can use context to tell what&#x2019;s signi&#xfb01;cant and what should be ignored.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:124pt;left:428pt"><span style="font-family:Times,serif;font-size:9.963pt">Computer</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:136pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">programs have much more trouble with this.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:136pt;left:259pt"><span style="font-family:Times,serif;font-size:9.963pt">Without either unambiguous end markers on output</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:148pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">or advance knowledge of the length of the output, they can&#x2019;t tell when to stop reading.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:170pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">Even worse is when a program&#x2019;s input is buffered (often inadvertently, as by stdio).</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:181pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">A program that stops overtly reading at the right place can nonetheless eat past it.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:193pt;left:422pt"><span style="font-family:Times,serif;font-size:9.963pt">&#x2014;</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:205pt;left:301pt"><span style="font-family:Times,serif;font-size:9.963pt;color:#ff0000">&lt;author&gt;DougMcIlroy&lt;/author&gt;</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:227pt;left:71pt"><span style="font-family:Times,serif;font-size:9.963pt">Programs in which master processes are trying to do interactive things with slaved minilanguages</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:239pt;left:71pt"><span style="font-family:Times,serif;font-size:9.963pt">that are not carefully designed around this problem are prone to deadlock as the master and slave</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:251pt;left:71pt"><span style="font-family:Times,serif;font-size:9.963pt">fall out of synchronization (a problem we &#xfb01;rst noted in Chapter 7).</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:273pt;left:71pt"><span style="font-family:Times,serif;font-size:9.963pt">There are workarounds for driving minilanguages that are not so carefully designed. The prototype</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:285pt;left:71pt"><span style="font-family:Times,serif;font-size:9.963pt">for most of them is the Tcl</span><i><span style="font-family:Times,serif;font-size:9.963pt"> expect</span></i><span style="font-family:Times,serif;font-size:9.963pt"> package.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:285pt;left:261pt"><span style="font-family:Times,serif;font-size:9.963pt">This package assists conversation with CLIs.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:285pt;left:455pt"><span style="font-family:Times,serif;font-size:9.963pt">It&#x2019;s</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:297pt;left:71pt"><span style="font-family:Times,serif;font-size:9.963pt">built around the following operation: read from slave until either a given regular-expression pattern</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:309pt;left:71pt"><span style="font-family:Times,serif;font-size:9.963pt">is matched or a speci&#xfb01;ed timeout elapses. With this (and, of course, a send-to-slave operation) it&#x2019;s</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:321pt;left:71pt"><span style="font-family:Times,serif;font-size:9.963pt">often possible to construct master programs to do reliable dialogues with slave processes even when</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:333pt;left:71pt"><span style="font-family:Times,serif;font-size:9.963pt">the latter have not been tailored for the role.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:355pt;left:71pt"><span style="font-family:Times,serif;font-size:9.963pt">Workalikes of the</span><i><span style="font-family:Times,serif;font-size:9.963pt"> expect</span></i><span style="font-family:Times,serif;font-size:9.963pt"> package in other languages are available; a Web search for the name of</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:367pt;left:71pt"><span style="font-family:Times,serif;font-size:9.963pt">your favorite language with the added keywords &#x201c;Tcl expect&#x201d; is quite likely to turn up something</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:379pt;left:71pt"><span style="font-family:Times,serif;font-size:9.963pt">useful.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:379pt;left:107pt"><span style="font-family:Times,serif;font-size:9.963pt">As a minilanguage designer, however, you would be unwise to assume that all your users</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:391pt;left:71pt"><span style="font-family:Times,serif;font-size:9.963pt">will be</span><i><span style="font-family:Times,serif;font-size:9.963pt"> expect</span></i><span style="font-family:Times,serif;font-size:9.963pt"> gurus. Even if they are, this is an extra glue layer and a place for things to go wrong.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:413pt;left:71pt"><span style="font-family:Times,serif;font-size:9.963pt">Be aware of this issue when designing your minilanguage. It may be a good idea to add an option</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:425pt;left:71pt"><span style="font-family:Times,serif;font-size:9.963pt">that changes its conversational behavior to make it respond more like an application protocol, with</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:437pt;left:71pt"><span style="font-family:Times,serif;font-size:9.963pt">unambiguous end-of-output delimiters and an analog of byte stuf&#xfb01;ng.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:581pt;left:262pt"><span style="font-family:Times,serif;font-size:9.963pt">248</span></p>
</div>

<div id="page0" style="position:relative;width:540pt;height:648pt;background-color:white">
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:32pt;left:225pt"><span style="font-family:Times,serif;font-size:9.963pt">Chapter 4. Modularity</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:95pt;left:72pt"><b><span style="font-family:Helvetica,sans-serif;font-size:15.94pt">Encapsulation and Optimal Module Size</span></b></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:123pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">The &#xfb01;rst and most important quality of modular code is</span><i><span style="font-family:Times,serif;font-size:9.963pt"> encapsulation</span></i><span style="font-family:Times,serif;font-size:9.963pt">. Well-encapsulated modules</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:135pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">don&#x2019;t expose their internals to each other.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:135pt;left:266pt"><span style="font-family:Times,serif;font-size:9.963pt">They don&#x2019;t call into the middle of each others&#x2019;</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:147pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">implementations, and they don&#x2019;t promiscuously share global data.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:147pt;left:363pt"><span style="font-family:Times,serif;font-size:9.963pt">They communicate using</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:159pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">application programming interfaces (APIs) &#x2014; narrow, well-de&#xfb01;ned sets of procedure calls and data</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:171pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">structures. This is what the Rule of Modularity is about.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:192pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">The APIs between modules have a dual role. On the implementation level, they function as choke</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:204pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">points between the modules, preventing the internals of each from leaking into its neighbors.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:204pt;left:455pt"><span style="font-family:Times,serif;font-size:9.963pt">On</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:216pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">the design level, it is the APIs (not the bits of implementation between them) that really de&#xfb01;ne your</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:228pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">architecture.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:249pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">One good test for whether an API is well designed is this one: if you try to write a description of</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:261pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">it in purely human language (with no source-code extracts allowed), does it make sense?</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:261pt;left:444pt"><span style="font-family:Times,serif;font-size:9.963pt">It is a</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:273pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">very good idea to get into the habit of writing informal descriptions of your APIs before you code</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:285pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">them.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:285pt;left:106pt"><span style="font-family:Times,serif;font-size:9.963pt">Indeed, some of the most able developers start by de&#xfb01;ning their interfaces, writing brief</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:297pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">comments to describe them, and then writing the code &#x2014; since the process of writing the comment</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:309pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">clari&#xfb01;es what the code must do.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:309pt;left:213pt"><span style="font-family:Times,serif;font-size:9.963pt">Such descriptions help you organize your thoughts, they make</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:321pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">useful module comments, and eventually you might want to turn them into a roadmap document for</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:333pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">future readers of the code.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:354pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">As you push module decomposition harder, the pieces get smaller and the de&#xfb01;nition of the APIs gets</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:366pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">more important. Global complexity, and consequent vulnerability to bugs, decreases.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:366pt;left:423pt"><span style="font-family:Times,serif;font-size:9.963pt">It has been</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:378pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">received wisdom in computer science since the 1970s (exempli&#xfb01;ed in papers such as [Parnas]) that</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:390pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">you ought to design your software systems as hierarchies of nested modules, with the grain size of</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:402pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">the modules at each level held to a minimum.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:423pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">It is possible, however, to push this kind of decomposition too hard and make your modules too</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:435pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">small.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:435pt;left:107pt"><span style="font-family:Times,serif;font-size:9.963pt">There is evidence [Hatton97] that when one plots defect density versus module size, the</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:447pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">curve is U-shaped and concave upwards (see Figure 4.1).</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:447pt;left:312pt"><span style="font-family:Times,serif;font-size:9.963pt">Very small and very large modules are</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:459pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">associated with more bugs than those of intermediate size. A different way of viewing the same</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:471pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">data is to plot lines of code per module versus total bugs. The curve looks roughly logarithmic up</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:483pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">to a &#x2018;sweet spot&#x2019; where it &#xfb02;attens (corresponding to the minimum in the defect density curve), after</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:495pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">which it goes up as the square of the number of the lines of code (which is what one might intuitively</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:507pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">expect for the whole curve, following Brooks&#x2019;s Law</span><sup><span style="font-family:Times,serif;font-size:6.273pt">41</span></sup><span style="font-family:Times,serif;font-size:9.963pt">).</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:526pt;left:72pt"><span style="font-family:Times,serif;font-size:5.018pt">41</span><span style="font-family:Times,serif;font-size:7.97pt">Brooks&#x2019;s Law predicts that adding programmers to a late project makes it later. More generally, it predicts that costs and</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:536pt;left:72pt"><span style="font-family:Times,serif;font-size:7.97pt">error rates rise as the square of the number of programmers on a project.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:581pt;left:262pt"><span style="font-family:Times,serif;font-size:9.963pt">109</span></p>
</div>

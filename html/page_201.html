<div id="page0" style="position:relative;width:540pt;height:648pt;background-color:white">
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:32pt;left:209pt"><span style="font-family:Times,serif;font-size:9.963pt">Chapter 7. Multiprogramming</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:96pt;left:72pt"><b><span style="font-family:Helvetica,sans-serif;font-size:13.948pt">Slave Processes</span></b></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:122pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Occasionally, child programs both accept data from and return data to their callers through pipes con-</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:133pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">nected to standard input and output, interactively. Unlike simple shellouts and what we have called</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:145pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">&#x2018;bolt-ons&#x2019; above, both master and slave processes need to have internal state machines to handle a</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:157pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">protocol between them without deadlocking or racing. This is a drastically more complex and more</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:169pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">dif&#xfb01;cult-to-debug organization than a simple shellout.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:191pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Unix&#x2019;s popen(3) call can set up either an input pipe or an output pipe for a shellout, but not both for</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:203pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">a slave process &#x2014; this seems intended to encourage simpler programming. And, in fact, interactive</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:215pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">master-slave communication is tricky enough that it is normally only used when either (a) the</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:227pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">implied protocol is utterly trivial, or (b) the slave process has been designed to speak an application</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:239pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">protocol along the lines we discussed in Chapter 5. We&#x2019;ll return to this issue, and ways to cope with</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:251pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">it, in Chapter 8.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:272pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">When writing a master/slave pair, it is good practice for the master to support a command-line switch</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:284pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">or environment variable that allows callers to set their own slave command.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:284pt;left:385pt"><span style="font-family:Times,serif;font-size:9.963pt">Among other things,</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:296pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">this is useful for debugging; you will often &#xfb01;nd it handy during development to invoke the real slave</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:308pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">process from within a harness that monitors and logs transactions between slave and master.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:330pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">If you &#xfb01;nd that master/slave interactions in your program are becoming nontrivial, it may be time</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:342pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">to think about going the rest of the way to a more peer-to-peer organization, using techniques like</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:354pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">sockets or shared memory.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:375pt;left:72pt"><b><span style="font-family:Helvetica,sans-serif;font-size:11.955pt">Case Study:</span></b><b><i><span style="font-family:Helvetica,sans-serif;font-size:11.955pt"> scp</span></i></b><b><span style="font-family:Helvetica,sans-serif;font-size:11.955pt"> and</span></b><b><i><span style="font-family:Helvetica,sans-serif;font-size:11.955pt"> ssh</span></i></b></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:399pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">One common case in which the implied protocol really is trivial is progress meters.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:399pt;left:424pt"><span style="font-family:Times,serif;font-size:9.963pt">The scp(1)</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:411pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">secure-copy command calls ssh(1) as a slave process, intercepting enough information from ssh&#x2019;s</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:423pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">standard output to reformat the reports as an ASCII animation of a progress bar.</span><sup><span style="font-family:Times,serif;font-size:6.273pt">73</span></sup></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:445pt;left:72pt"><b><span style="font-family:Helvetica,sans-serif;font-size:13.948pt">Peer-to-Peer Inter-Process Communication</span></b></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:471pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">All the communication methods we&#x2019;ve discussed so far have a sort of implicit hierarchy about them,</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:483pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">with one program effectively controlling or driving another and zero or limited feedback passing</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:495pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">in the opposite direction. In communications and networking we frequently need channels that</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:507pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">are</span><i><span style="font-family:Times,serif;font-size:9.963pt"> peer-to-peer</span></i><span style="font-family:Times,serif;font-size:9.963pt">, usually (but not necessarily) with data &#xfb02;owing freely in both directions. We&#x2019;ll</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:526pt;left:72pt"><span style="font-family:Times,serif;font-size:5.018pt">73</span><span style="font-family:Times,serif;font-size:7.97pt">The friend who suggested this case study comments: &#x201c;Yes, you can get away with this technique...if there are just a few</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:536pt;left:72pt"><span style="font-family:Times,serif;font-size:7.97pt">easily-recognizable nuggets of information coming back from the slave process, and you have tongs and a radiation suit&#x201d;.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:581pt;left:262pt"><span style="font-family:Times,serif;font-size:9.963pt">200</span></p>
</div>

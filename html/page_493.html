<div id="page0" style="position:relative;width:540pt;height:648pt;background-color:white">
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:32pt;left:219pt"><span style="font-family:Times,serif;font-size:9.963pt">Chapter 19. Open Source</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:100pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">nobody knows any signi&#xfb01;cant fraction of them). By creating a separate portability layer, it becomes</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:112pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">possible for a specialist who knows a platform to port your software without having to understand</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:124pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">anything outside the portability layer.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:146pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Portability layers also simplify applications. Software rarely needs the full functionality of more</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:158pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">complex system calls such as mmap(2) or stat(2), and programmers commonly con&#xfb01;gure such</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:170pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">complex interfaces incorrectly. A portability layer with abstracted interfaces (say, something named</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:181pt;left:72pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt">__file_exists</span></tt><span style="font-family:Times,serif;font-size:9.963pt"> instead of a call to stat(2)) allows you to import only the limited, necessary</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:193pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">functionality from the system, simplifying the code in your application.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:215pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Always write your portability layer to select based on a feature, never based on a platform. Trying to</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:227pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">create a separate portability layer for each supported platform results in a multiple update problem</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:239pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">maintenance nightmare. A &#x201c;platform&#x201d; is always selected on at least two axes: the compiler and the</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:251pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">library/operating system release. In some cases there are three axes, as when Linux vendors select</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:263pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">a C library independently of the operating system release. With</span><i><span style="font-family:Times,serif;font-size:9.963pt"> M</span></i><span style="font-family:Times,serif;font-size:9.963pt"> vendors,</span><i><span style="font-family:Times,serif;font-size:9.963pt"> N</span></i><span style="font-family:Times,serif;font-size:9.963pt"> compilers, and</span><i><span style="font-family:Times,serif;font-size:9.963pt"> O</span></i></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:275pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">operating system releases, the number of platforms quickly scales out of reach of any but the largest</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:287pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">development teams. On the other hand, by using language and systems standards such as ANSI and</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:299pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">POSIX 1003.1, the set of features is relatively constrained.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:321pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Portability choices can be made along either lines of code or compiled &#xfb01;les.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:321pt;left:402pt"><span style="font-family:Times,serif;font-size:9.963pt">It doesn&#x2019;t make</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:333pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">a difference if you select alternate lines of code on a platform, or one of a few different &#xfb01;les.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:345pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">A rule of thumb is to move portability code for different platforms into separate &#xfb01;les when the</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:357pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">implementations diverge signi&#xfb01;cantly (shared memory mapping on Unix vs. Windows), and leave</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:369pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">portability code in a single &#xfb01;le when the differences are minimal (for example, whether you&#x2019;re using</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:381pt;left:72pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt">gettimeofday</span></tt><span style="font-family:Times,serif;font-size:9.963pt">,</span><tt><span style="font-family:Courier,monospace;font-size:8.966pt"> clock_gettime</span></tt><span style="font-family:Times,serif;font-size:9.963pt">,</span><tt><span style="font-family:Courier,monospace;font-size:8.966pt"> ftime</span></tt><span style="font-family:Times,serif;font-size:9.963pt"> or</span><tt><span style="font-family:Courier,monospace;font-size:8.966pt"> time</span></tt><span style="font-family:Times,serif;font-size:9.963pt"> to &#xfb01;nd out the current time-of-day).</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:403pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">For anywhere outside a portability layer, heed this advice:</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:425pt;left:108pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt">#ifdef</span></tt><span style="font-family:Times,serif;font-size:9.963pt"> and</span><tt><span style="font-family:Courier,monospace;font-size:8.966pt"> #if</span></tt><span style="font-family:Times,serif;font-size:9.963pt"> are last resorts, usually a sign of failure of imagination, excessive</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:437pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">product differentiation, gratuitous &#x201c;optimization&#x201d; or accumulated trash. In the</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:448pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">middle of code they are anathema.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:448pt;left:255pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt">/usr/include/stdio.h</span></tt><span style="font-family:Times,serif;font-size:9.963pt"> from GNU is an</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:460pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">archetypical horror.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:472pt;left:422pt"><span style="font-family:Times,serif;font-size:9.963pt">&#x2014;</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:484pt;left:301pt"><span style="font-family:Times,serif;font-size:9.963pt;color:#ff0000">&lt;author&gt;DougMcIlroy&lt;/author&gt;</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:506pt;left:71pt"><span style="font-family:Times,serif;font-size:9.963pt">Use of</span><tt><span style="font-family:Courier,monospace;font-size:8.966pt"> #ifdef</span></tt><span style="font-family:Times,serif;font-size:9.963pt"> and</span><tt><span style="font-family:Courier,monospace;font-size:8.966pt"> #if</span></tt><span style="font-family:Times,serif;font-size:9.963pt"> is permissible (if well controlled) within a portability layer. Outside it, try</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:518pt;left:71pt"><span style="font-family:Times,serif;font-size:9.963pt">hard to con&#xfb01;ne these to conditionalizing</span><tt><span style="font-family:Courier,monospace;font-size:8.966pt"> #includes</span></tt><span style="font-family:Times,serif;font-size:9.963pt"> based on feature symbols.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:581pt;left:262pt"><span style="font-family:Times,serif;font-size:9.963pt">492</span></p>
</div>

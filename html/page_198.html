<div id="page0" style="position:relative;width:540pt;height:648pt;background-color:white">
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:32pt;left:209pt"><span style="font-family:Times,serif;font-size:9.963pt">Chapter 7. Multiprogramming</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:100pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">pipeline. Suppose for a moment it were broken up into several programs: a couple of fetch programs</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:112pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">to get mail from POP3 and IMAP sites, and a local SMTP injector.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:112pt;left:349pt"><span style="font-family:Times,serif;font-size:9.963pt">The pipeline could pass Unix</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:124pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">mailbox format.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:124pt;left:146pt"><span style="font-family:Times,serif;font-size:9.963pt">The present elaborate</span><i><span style="font-family:Times,serif;font-size:9.963pt"> fetchmail</span></i><span style="font-family:Times,serif;font-size:9.963pt"> con&#xfb01;guration could be replaced by a shellscript</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:136pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">containing command lines. One could even insert &#xfb01;lters in the pipeline to block spam.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:169pt;left:72pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt">#!/bin/sh</span></tt></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:180pt;left:72pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt">imap jrandom@imap.ccil.org | spamblocker | smtp jrandom</span></tt></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:191pt;left:72pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt">imap jrandom@imap.netaxs.com | smtp jrandom</span></tt></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:202pt;left:72pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt"># pop ed@pop.tems.com | smtp jrandom</span></tt></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:232pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">This would be very elegant and Unixy.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:232pt;left:238pt"><span style="font-family:Times,serif;font-size:9.963pt">Unfortunately, it can&#x2019;t work.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:232pt;left:363pt"><span style="font-family:Times,serif;font-size:9.963pt">We touched on the reason</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:244pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">earlier; pipelines are unidirectional.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:266pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">One of the things the fetcher program (</span><i><span style="font-family:Times,serif;font-size:9.963pt">imap</span></i><span style="font-family:Times,serif;font-size:9.963pt"> or</span><i><span style="font-family:Times,serif;font-size:9.963pt"> pop</span></i><span style="font-family:Times,serif;font-size:9.963pt">) would have to do is decide whether to send a</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:278pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">delete request for each message it fetches. In</span><i><span style="font-family:Times,serif;font-size:9.963pt"> fetchmail</span></i><span style="font-family:Times,serif;font-size:9.963pt">&#x2019;s present organization, it can delay sending</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:290pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">that request to the POP or IMAP server until it knows that the local SMTP listener has accepted</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:302pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">responsibility for the message. The pipelined, small-component version would lose that property.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:324pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Consider, for example, what would happen if the</span><i><span style="font-family:Times,serif;font-size:9.963pt"> smtp</span></i><span style="font-family:Times,serif;font-size:9.963pt"> injector fails because the SMTP listener</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:336pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">reports a disk-full condition. If the fetcher has already deleted the mail, we lose.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:336pt;left:406pt"><span style="font-family:Times,serif;font-size:9.963pt">This means the</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:348pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">fetcher cannot delete mail until it is noti&#xfb01;ed to do so by the</span><i><span style="font-family:Times,serif;font-size:9.963pt"> smtp</span></i><span style="font-family:Times,serif;font-size:9.963pt"> injector.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:348pt;left:386pt"><span style="font-family:Times,serif;font-size:9.963pt">This in turn raises a</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:360pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">host of questions. How would they communicate? What message, exactly, would the injector pass</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:372pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">back? The global complexity of the resulting system, and its vulnerability to subtle bugs, would</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:384pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">almost certainly be higher than that of a monolithic program.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:405pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Pipelines are a marvelous tool, but not a universal one.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:428pt;left:72pt"><b><span style="font-family:Helvetica,sans-serif;font-size:13.948pt">Wrappers</span></b></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:454pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">The opposite of a shellout is a</span><i><span style="font-family:Times,serif;font-size:9.963pt"> wrapper</span></i><span style="font-family:Times,serif;font-size:9.963pt">. A wrapper creates a new interface for a called program, or</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:466pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">specializes it. Often, wrappers are used to hide the details of elaborate shell pipelines. We&#x2019;ll discuss</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:478pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">interface wrappers in Chapter 11. Most specialization wrappers are quite simple, but nevertheless</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:490pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">very useful.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:512pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">As with shellouts, there is no associated protocol because the programs do not communicate during</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:524pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">the execution of the callee; but the wrapper usually exists to specify arguments that modify the</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:536pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">callee&#x2019;s behavior.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:581pt;left:262pt"><span style="font-family:Times,serif;font-size:9.963pt">197</span></p>
</div>

<div id="page0" style="position:relative;width:612pt;height:792pt;background-color:white">
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:95pt;left:468pt"><i><span style="font-family:BookAntiqua,serif;font-size:9pt">Chapter 8</span></i></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:666pt;left:293pt"><b><span style="font-family:Arial,sans-serif;font-size:9pt">[</span></b><b><span style="font-family:Arial,sans-serif;font-size:8pt"> 131 </span></b><b><span style="font-family:Arial,sans-serif;font-size:9pt">]</span></b></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:115pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">There are few testing libraries which support test spies, stubs, and mocks. However, </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:127pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">we found </span><span style="font-family:CourierStd,serif;font-size:9.5pt">SinonJS</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt"> quite easy to work with and robust as well. </span><span style="font-family:CourierStd,serif;font-size:9.5pt">SinonJS</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt"> works </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:140pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">seamlessly with </span><span style="font-family:CourierStd,serif;font-size:9.5pt">QUnit</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt"> and you can use it with or without </span><span style="font-family:CourierStd,serif;font-size:9.5pt">QUnit</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt"> too. The definition </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:153pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">of </span><span style="font-family:CourierStd,serif;font-size:9.5pt">SinonJS</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt">, as given on their website, is as follows:</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:174pt;left:129pt"><i><span style="font-family:BookAntiqua,serif;font-size:10.5pt">Standalone test spies, stubs and mocks for JavaScript. No dependencies, works with </span></i></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:187pt;left:129pt"><i><span style="font-family:BookAntiqua,serif;font-size:10.5pt">any unit testing framework.</span></i></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:218pt;left:108pt"><b><span style="font-family:Arial,sans-serif;font-size:18pt">Testing with spies</span></b></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:240pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">We first need to know what a spy is. By definition, as given on the </span><span style="font-family:CourierStd,serif;font-size:9.5pt">SinonJS</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt"> website, </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:252pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">a spy is as follows:</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:274pt;left:129pt"><i><span style="font-family:BookAntiqua,serif;font-size:10.5pt">A test spy is a function that records arguments, return value, the value of this and </span></i></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:287pt;left:129pt"><i><span style="font-family:BookAntiqua,serif;font-size:10.5pt">exception thrown (if any) for all its calls. A test spy can be an anonymous function </span></i></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:299pt;left:129pt"><i><span style="font-family:BookAntiqua,serif;font-size:10.5pt">or it can wrap an existing function.</span></i></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:321pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">So your next question should be why a spy should be used. We use test spies to </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:333pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">test the behavior of callback and other methods, and to understand how they work. </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:346pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">You will find out the answer in more detail once you look into some API methods </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:359pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">associated with spies:</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:380pt;left:125pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">&#x2022; </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:380pt;left:144pt"><span style="font-family:CourierStd,serif;font-size:9.5pt">called()</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt">: This returns true if the spy was called at least once</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:397pt;left:126pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">&#x2022; </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:397pt;left:144pt"><span style="font-family:CourierStd,serif;font-size:9.5pt">calledOnce()</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt">: This returns true if the spy was called exactly once</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:414pt;left:126pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">&#x2022; </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:414pt;left:144pt"><span style="font-family:CourierStd,serif;font-size:9.5pt">returned()</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt">: This returns true if the spy returned the provided value at  </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:426pt;left:144pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">least once</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:447pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">These are few of the supported methods of the spy API. Hopefully, now you can </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:460pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">understand why a spy is used&#x2014;it allows you to test multiple characteristics of a </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:473pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">function, to know whether it gets called only once, or to check what value it returns. </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:485pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">A spy allows you every possibility to test the complete flow of a function. Now let&apos;s </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:498pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">see how to use a spy from the following code snippet:</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:519pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">// A User model definition</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:532pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">var User = Backbone.Model.extend({</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:544pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  defaults: {</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:556pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">    name: &apos;&apos;</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:568pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  },</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:593pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  // Split the name to provide an array of first and last name</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:605pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  getNameAsArray: function () {</span></p>
</div>

<div id="page0" style="position:relative;width:540pt;height:648pt;background-color:white">
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:32pt;left:219pt"><span style="font-family:Times,serif;font-size:9.963pt">Chapter 12. Optimization</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:100pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Coherency can be guaranteed in simple cases. One such is the Python interpreter, which compiles</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:112pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">and deposits on disk a p-code &#xfb01;le with extension</span><tt><span style="font-family:Courier,monospace;font-size:8.966pt"> .pyc</span></tt><span style="font-family:Times,serif;font-size:9.963pt"> when a Python library &#xfb01;le is &#xfb01;rst imported.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:124pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">On subsequent runs the cached copy of the p-code is loaded unless the source has since changed</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:136pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">(this avoids reparsing the library source code on every run).</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:136pt;left:321pt"><span style="font-family:Times,serif;font-size:9.963pt">Emacs Lisp uses a similar technique</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:148pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">with</span><tt><span style="font-family:Courier,monospace;font-size:8.966pt"> .el</span></tt><span style="font-family:Times,serif;font-size:9.963pt"> and</span><tt><span style="font-family:Courier,monospace;font-size:8.966pt"> .elc</span></tt><span style="font-family:Times,serif;font-size:9.963pt"> &#xfb01;les. This technique works because both read and write accesses to the cache</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:160pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">go through a single program.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:181pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">When the update pattern of the master is more complex, however, the synchronization code tends</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:193pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">to spring leaks. The Unix variants that used this technique to speed up access to critical system</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:205pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">databases were infamous for spawning system-administrator horror stories that re&#xfb02;ected this.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:227pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">In general, binary cache &#xfb01;les are a brittle technique and probably best avoided. The work that went</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:239pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">into implementing a special-purpose hack to reduce latency in this one case would have been better</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:251pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">spent improving the application design so it doesn&#x2019;t have a bottleneck there &#x2014; or even on tuning to</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:263pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">improve the speed of the &#xfb01;le system or the virtual-memory implementation.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:285pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">When you think you are in a situation that demands caching, it is wise to look one level deeper and</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:297pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">ask why the caching is necessary. It may well be no more dif&#xfb01;cult to solve that problem than it</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:309pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">would be to get all the edge cases in the caching software right.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:581pt;left:262pt"><span style="font-family:Times,serif;font-size:9.963pt">334</span></p>
</div>

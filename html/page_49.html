<div id="page0" style="position:relative;width:612pt;height:792pt;background-color:white">
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:95pt;left:468pt"><i><span style="font-family:BookAntiqua,serif;font-size:9pt">Chapter 2</span></i></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:666pt;left:295pt"><b><span style="font-family:Arial,sans-serif;font-size:9pt">[</span></b><b><span style="font-family:Arial,sans-serif;font-size:8pt"> 33 </span></b><b><span style="font-family:Arial,sans-serif;font-size:9pt">]</span></b></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:115pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">      model: model</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:127pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">    });</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:152pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">    this.$el.append(userItemView.render().el);</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:164pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  }, this);</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:188pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  return this;</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:200pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">}</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:220pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">We create new instances of </span><span style="font-family:CourierStd,serif;font-size:9.5pt">UserViewItem</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt">, pass the model to it, and render it inside </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:232pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">the main view. The</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt"> event listeners are now subview-specific and the subview </span><span style="font-family:BookAntiqua,serif;font-size:10.5pt">methods </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:245pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">can directly access the model attached to it. This makes the application flow cleaner </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:258pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">and also eliminates the extra time that, though small, is required to look up the </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:270pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">collection for a particular model through its ID. If your view has multiple similar child </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:283pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">items, and each child item needs its own set of events, subviews are the right approach.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:304pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">In the final section of this chapter, we will look at an awesome library, MarionetteJS, </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:317pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">which provides some useful readymade BackboneJS extensions. The </span><span style="font-family:CourierStd,serif;font-size:9.5pt">ItemView</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt"> and </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:329pt;left:108pt"><span style="font-family:CourierStd,serif;font-size:9.5pt">CollectionView</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt"> extensions provide a functionality that is similar to the previous </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:342pt;left:107pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">example but in a more robust and flexible way.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:373pt;left:108pt"><b><span style="font-family:Arial,sans-serif;font-size:18pt">Avoiding multiple DOM reflow</span></b></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:395pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">We used jQuery&apos;s </span><span style="font-family:CourierStd,serif;font-size:9.5pt">$.append()</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt"> method to add the subview elements to the main </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:407pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">view. It is found that if there is a large collection of data, appending view elements </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:420pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">to the DOM one by one can create a severe performance issue; this will affect the </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:432pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">UI responsiveness of the application. The performance hit can be noticed even in </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:445pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">modern browsers, since every append causes a DOM reflow and forces the browser </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:458pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">to recalculate the size and position of the DOM tree.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:479pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">This multiple DOM reflow can be avoided by using </span><span style="font-family:CourierStd,serif;font-size:9.5pt">DocumentFragment</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt">, which is </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:492pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">described at </span><span style="font-family:CourierStd,serif;font-size:9.5pt">http://ejohn.org/blog/dom-documentfragments</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt"> by </span><i><span style="font-family:BookAntiqua,serif;font-size:10.5pt">John Resig</span></i><span style="font-family:BookAntiqua,serif;font-size:10.5pt"> as </span><i><span style="font-family:BookAntiqua,serif;font-size:10.5pt">a </span></i></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:504pt;left:108pt"><i><span style="font-family:BookAntiqua,serif;font-size:10.5pt">lightweight container that can hold DOM nodes</span></i><span style="font-family:BookAntiqua,serif;font-size:10.5pt">. We can collect all of the view elements </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:517pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">inside </span><span style="font-family:CourierStd,serif;font-size:9.5pt">DocumentFragment</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt"> and then append this fragment to the DOM. This will cause </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:529pt;left:107pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">a single reflow for the complete collection, and hence a performance improvement.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:551pt;left:107pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">Let&apos;s see the </span><span style="font-family:CourierStd,serif;font-size:9.5pt">render()</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt"> method with a single reflow:</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:572pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">render: function () {</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:584pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  // create a document fragment</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:596pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  var fragment = document.createDocumentFragment();</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:621pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  this.collection.each(function (model) {</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:633pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">    // add each view element to the document fragment</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:645pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">    fragment.appendChild(new UserItemView({</span></p>
</div>

<div id="page0" style="position:relative;width:540pt;height:648pt;background-color:white">
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:32pt;left:225pt"><span style="font-family:Times,serif;font-size:9.963pt">Chapter 9. Generation</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:100pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">initializer.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:100pt;left:120pt"><span style="font-family:Times,serif;font-size:9.963pt">The problem with this method is that the extra data in the C initializer format (trailing</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:112pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">newline, string quotes, comma) would make the lines longer than 79 characters, causing them to</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:124pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">wrap and making it rather dif&#xfb01;cult to map the appearance of the code to the appearance of the</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:136pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">output.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:136pt;left:110pt"><span style="font-family:Times,serif;font-size:9.963pt">This, in turn, would make the display dif&#xfb01;cult to edit, which was annoying when I was</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:148pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">tinkering it to &#xfb01;t in 24&#xd7;80 screen cells.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:169pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">A more sophisticated method using the string-pasting behavior of the ANSI C preprocessor collided</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:181pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">with a variant of the same problem. Essentially, any way of inlining the usage screen explicitly</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:189pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">would involve punctuation at start and end of line that there&#x2019;s no room for.</span><sup><span style="font-family:Times,serif;font-size:6.273pt">98</span></sup><sup><span style="font-family:Times,serif;font-size:9.963pt"> </span></sup><span style="font-family:Times,serif;font-size:9.963pt">And copying the table</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:205pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">to the screen from a &#xfb01;le at runtime seemed like a fragile expedient; after all, the &#xfb01;le could get lost.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:226pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Here&#x2019;s the solution.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:226pt;left:165pt"><span style="font-family:Times,serif;font-size:9.963pt">The source distribution contains a &#xfb01;le that just contains the usage screen,</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:238pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">exactly as listed above and named</span><tt><span style="font-family:Courier,monospace;font-size:8.966pt"> splashscreen</span></tt><span style="font-family:Times,serif;font-size:9.963pt">. The C source contains the following function:</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:271pt;left:72pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt">void</span></tt></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:282pt;left:72pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt">showHelp(FILE *out, char *progname)</span></tt></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:293pt;left:72pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt">{</span></tt></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:304pt;left:79pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt">fprintf(out,&quot;Usage: %s [-dxohv] [-t] [char-alias...]\n&quot;, progname);</span></tt></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:314pt;left:72pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt">#include &quot;splashscreen.h&quot;</span></tt></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:336pt;left:79pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt">exit(0);</span></tt></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:347pt;left:72pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt">}</span></tt></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:377pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">And</span><tt><span style="font-family:Courier,monospace;font-size:8.966pt"> splashscreen.h</span></tt><span style="font-family:Times,serif;font-size:9.963pt"> is generated by a make&#xfb01;le production:</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:410pt;left:71pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt">splashscreen.h: splashscreen</span></tt></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:421pt;left:102pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt">sed &lt;splashscreen &gt;splashscreen.h \</span></tt></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:431pt;left:117pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt">-e &#x2019;s/\\/\\\\/g&#x2019; -e &#x2019;s/&quot;/\\&quot;/&#x2019; -e &#x2019;s/.*/puts(&quot;&amp;&quot;);/&#x2019;</span></tt></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:462pt;left:71pt"><span style="font-family:Times,serif;font-size:9.963pt">So when the program is built, the</span><tt><span style="font-family:Courier,monospace;font-size:8.966pt"> splashscreen</span></tt><span style="font-family:Times,serif;font-size:9.963pt"> &#xfb01;le is automatically massaged into a series of</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:473pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">output function calls, which are then included by the C preprocessor in the right function.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:495pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">By generating the code from data, we get to keep the editable version of the usage screen identical</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:507pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">to its display appearance.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:507pt;left:182pt"><span style="font-family:Times,serif;font-size:9.963pt">This promotes transparency.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:507pt;left:304pt"><span style="font-family:Times,serif;font-size:9.963pt">Furthermore, we could modify the usage</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:526pt;left:72pt"><span style="font-family:Times,serif;font-size:5.018pt">98</span><span style="font-family:Times,serif;font-size:7.97pt">Scripting languages tend to solve this problem more elegantly than C does. Investigate the shell&#x2019;s</span><i><span style="font-family:Times,serif;font-size:7.97pt"> here documents</span></i><span style="font-family:Times,serif;font-size:7.97pt"> and</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:536pt;left:72pt"><span style="font-family:Times,serif;font-size:7.97pt">Python&#x2019;s triple-quote construct to &#xfb01;nd out how.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:581pt;left:262pt"><span style="font-family:Times,serif;font-size:9.963pt">261</span></p>
</div>

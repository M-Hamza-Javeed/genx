<div id="page0" style="position:relative;width:540pt;height:648pt;background-color:white">
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:32pt;left:209pt"><span style="font-family:Times,serif;font-size:9.963pt">Chapter 7. Multiprogramming</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:100pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">survey peer-to-peer communications methods under Unix here, and develop some case studies in</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:112pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">later chapters.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:134pt;left:72pt"><b><span style="font-family:Helvetica,sans-serif;font-size:11.955pt">Temp&#xfb01;les</span></b></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:158pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">The use of temp&#xfb01;les as communications drops between cooperating programs is the oldest IPC</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:170pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">technique there is.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:170pt;left:160pt"><span style="font-family:Times,serif;font-size:9.963pt">Despite drawbacks, it&#x2019;s still useful in shellscripts, and in one-off programs</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:182pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">where a more elaborate and coordinated method of communication would be overkill.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:204pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">The most obvious problem with using temp&#xfb01;les as an IPC technique is that it tends to leave garbage</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:216pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">lying around if processing is interrupted before the temp&#xfb01;le can be deleted. A less obvious risk is</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:228pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">that of collisions between multiple instances of a program using the same name for a temp&#xfb01;le. This</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:240pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">is why it is conventional for shellscripts that make temp&#xfb01;les to include $$ in their names; this shell</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:252pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">variable expands to the process-ID of the enclosing shell and effectively guarantees that the &#xfb01;lename</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:264pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">will be unique (the same trick is supported in Perl).</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:285pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Finally, if an attacker knows the location to which a temp&#xfb01;le will be written, it can overwrite on</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:297pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">that name and possibly either read the producer&#x2019;s data or spoof the consumer process by inserting</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:306pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">modi&#xfb01;ed or spurious data into the &#xfb01;le.</span><sup><span style="font-family:Times,serif;font-size:6.273pt">74</span></sup><sup><span style="font-family:Times,serif;font-size:9.963pt"> </span></sup><span style="font-family:Times,serif;font-size:9.963pt">This is a security risk. If the processes involved have root</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:321pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">privileges, this is a very serious risk. It can be mitigated by setting the permissions on the temp&#xfb01;le</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:333pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">directory carefully, but such arrangements are notoriously likely to spring leaks.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:355pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">All these problems aside, temp&#xfb01;les still have a niche because they&#x2019;re easy to set up, they&#x2019;re &#xfb02;exible,</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:367pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">and they&#x2019;re less vulnerable to deadlocks or race conditions than more elaborate methods. And</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:379pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">sometimes, nothing else will do.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:379pt;left:213pt"><span style="font-family:Times,serif;font-size:9.963pt">The calling conventions of your child process may require that</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:391pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">it be handed a &#xfb01;le to operate on.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:391pt;left:217pt"><span style="font-family:Times,serif;font-size:9.963pt">Our &#xfb01;rst example of a shellout to an editor demonstrates this</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:403pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">perfectly.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:425pt;left:72pt"><b><span style="font-family:Helvetica,sans-serif;font-size:11.955pt">Signals</span></b></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:449pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">The simplest and crudest way for two processes on the same machine to communicate with each</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:461pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">other is for one to send the other a</span><i><span style="font-family:Times,serif;font-size:9.963pt"> signal</span></i><span style="font-family:Times,serif;font-size:9.963pt">. Unix signals are a form of soft interrupt; each one has a</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:473pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">default effect on the receiving process (usually to kill it). A process can declare a</span><i><span style="font-family:Times,serif;font-size:9.963pt"> signal handler</span></i><span style="font-family:Times,serif;font-size:9.963pt"> that</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:485pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">overrides the default action for the signal; the handler is a function that is executed asynchronously</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:497pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">when the signal is received.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:514pt;left:72pt"><span style="font-family:Times,serif;font-size:5.018pt">74</span><span style="font-family:Times,serif;font-size:7.97pt"> A particularly nasty variant of this attack is to drop in a named Unix-domain socket where the producer and consumer</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:526pt;left:72pt"><span style="font-family:Times,serif;font-size:7.97pt">programs are expecting the temp&#xfb01;le to be.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:581pt;left:262pt"><span style="font-family:Times,serif;font-size:9.963pt">201</span></p>
</div>

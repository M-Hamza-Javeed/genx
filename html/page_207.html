<div id="page0" style="position:relative;width:540pt;height:648pt;background-color:white">
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:32pt;left:209pt"><span style="font-family:Times,serif;font-size:9.963pt">Chapter 7. Multiprogramming</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:100pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">the other hand, don&#x2019;t need to know anything about how the database is stored.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:100pt;left:409pt"><span style="font-family:Times,serif;font-size:9.963pt">Clients can be</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:112pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">specialized for different needs and have different user interfaces.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:134pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">This organization is quite typical for Unix databases &#x2014; so much so that it is often possible to mix and</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:146pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">match SQL clients and SQL servers. The interoperability issues are the SQL server&#x2019;s TCP/IP port</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:158pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">number, and whether client and server support the same dialect of SQL.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:179pt;left:72pt"><b><span style="font-family:Helvetica,sans-serif;font-size:10.959pt">Case Study: Freeciv</span></b></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:203pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">In Chapter 6, we introduced Freeciv as an example of transparent data formats.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:203pt;left:399pt"><span style="font-family:Times,serif;font-size:9.963pt">But more critical</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:215pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">to the way it supports multiplayer gaming is the client/server partitioning of the code.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:215pt;left:432pt"><span style="font-family:Times,serif;font-size:9.963pt">This is a</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:226pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">representative example of a program in which the application needs to be distributed over a wide-</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:238pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">area network and handles communication through TCP/IP sockets.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:260pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">The state of a running Freeciv game is maintained by a server process, the game engine. Players run</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:272pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">GUI clients which exchange information and commands with the server through a packet protocol.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:284pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">All game logic is handled in the server.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:284pt;left:246pt"><span style="font-family:Times,serif;font-size:9.963pt">The details of GUI are handled in the client; different</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:296pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">clients support different interface styles.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:318pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">This is a very typical organization for a multiplayer online game. The packet protocol uses TCP/IP as</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:330pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">a transport, so one server can handle clients running on different Internet hosts.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:330pt;left:415pt"><span style="font-family:Times,serif;font-size:9.963pt">Other games</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:342pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">that are more like real-time simulations (notably &#xfb01;rst-person shooters) use raw Internet datagram</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:354pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">protocol (UDP) and trade lower latency for some uncertainty about whether any given packet will</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:366pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">be delivered. In such games, users tend to be issuing control actions continuously, so sporadic</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:378pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">dropouts are tolerable, but lag is fatal.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:400pt;left:72pt"><b><span style="font-family:Helvetica,sans-serif;font-size:11.955pt">Shared Memory</span></b></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:424pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Whereas two processes using sockets to communicate may live on different machines (and, in fact,</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:436pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">be separated by an Internet connection spanning half the globe), shared memory requires producers</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:448pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">and consumers to be co-resident on the same hardware. But, if your communicating processes can</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:460pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">get access to the same physical memory, shared memory will be the fastest way to pass information</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:472pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">between them.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:494pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Shared memory may be disguised under different APIs, but on modern Unixes the implementation</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:506pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">normally depends on the use of mmap(2) to map &#xfb01;les into memory that can be shared between</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:518pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">processes. POSIX de&#xfb01;nes a shm_open(3) facility with an API that supports using &#xfb01;les as shared</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:581pt;left:262pt"><span style="font-family:Times,serif;font-size:9.963pt">206</span></p>
</div>

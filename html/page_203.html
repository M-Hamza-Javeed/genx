<div id="page0" style="position:relative;width:540pt;height:648pt;background-color:white">
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:32pt;left:209pt"><span style="font-family:Times,serif;font-size:9.963pt">Chapter 7. Multiprogramming</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:100pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Signals were originally designed into Unix as a way for the operating system to notify programs of</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:112pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">certain errors and critical events, not as an IPC facility. The</span><tt><span style="font-family:Courier,monospace;font-size:8.966pt"> SIGHUP</span></tt><span style="font-family:Times,serif;font-size:9.963pt"> signal, for example, is sent to</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:124pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">every program started from a given terminal session when that session is terminated. The</span><tt><span style="font-family:Courier,monospace;font-size:8.966pt"> SIGINT</span></tt></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:136pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">signal is sent to whatever process is currently attached to the keyboard when the user enters the</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:148pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">currently-de&#xfb01;ned interrupt character (often control-C). Nevertheless, signals can be useful for some</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:160pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">IPC situations (and the POSIX-standard signal set includes two signals,</span><tt><span style="font-family:Courier,monospace;font-size:8.966pt"> SIGUSR1</span></tt><span style="font-family:Times,serif;font-size:9.963pt"> and</span><tt><span style="font-family:Courier,monospace;font-size:8.966pt"> SIGUSR2</span></tt><span style="font-family:Times,serif;font-size:9.963pt">,</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:172pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">intended for this use). They are often employed as a control channel for</span><i><span style="font-family:Times,serif;font-size:9.963pt"> daemons</span></i><span style="font-family:Times,serif;font-size:9.963pt"> (programs that run</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:183pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">constantly, invisibly, in background), a way for an operator or another program to tell a daemon that</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:195pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">it needs to either reinitialize itself, wake up to do work, or write internal-state/debugging information</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:207pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">to a known location.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:229pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">I insisted</span><tt><span style="font-family:Courier,monospace;font-size:8.966pt"> SIGUSR1</span></tt><span style="font-family:Times,serif;font-size:9.963pt"> and</span><tt><span style="font-family:Courier,monospace;font-size:8.966pt"> SIGUSR2</span></tt><span style="font-family:Times,serif;font-size:9.963pt"> be invented for BSD. People were grabbing</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:241pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">system signals to mean what they needed them to mean for IPC, so that (for</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:253pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">example) some programs that segfaulted would not coredump because</span><tt><span style="font-family:Courier,monospace;font-size:8.966pt"> SIGSEGV</span></tt></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:265pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">had been hijacked.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:287pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">This is a general principle &#x2014; people will want to hijack any tools you build, so you</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:299pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">have to design them to either be un-hijackable or to be hijacked cleanly.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:299pt;left:407pt"><span style="font-family:Times,serif;font-size:9.963pt">Those</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:311pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">are your only choices. Except, of course, for being ignored&#x2014;a highly reliable way</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:323pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">to remain unsullied, but less satisfying than might at &#xfb01;rst appear.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:335pt;left:422pt"><span style="font-family:Times,serif;font-size:9.963pt">&#x2014;</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:347pt;left:311pt"><span style="font-family:Times,serif;font-size:9.963pt;color:#ff0000">&lt;author&gt;KenArnold&lt;/author&gt;</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:369pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">A technique often used with signal IPC is the so-called</span><i><span style="font-family:Times,serif;font-size:9.963pt"> pid&#xfb01;le</span></i><span style="font-family:Times,serif;font-size:9.963pt">. Programs that will need to be signaled</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:381pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">will write a small &#xfb01;le to a known location (often in</span><tt><span style="font-family:Courier,monospace;font-size:8.966pt"> /var/run</span></tt><span style="font-family:Times,serif;font-size:9.963pt"> or the invoking user&#x2019;s home directory)</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:393pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">containing their process ID or PID. Other programs can read that &#xfb01;le to discover that PID. The pid&#xfb01;le</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:405pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">may also function as an implicit</span><i><span style="font-family:Times,serif;font-size:9.963pt"> lock &#xfb01;le</span></i><span style="font-family:Times,serif;font-size:9.963pt"> in cases where no more than one instance of the daemon</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:417pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">should be running simultaneously.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:439pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">There are actually two different &#xfb02;avors of signals.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:439pt;left:293pt"><span style="font-family:Times,serif;font-size:9.963pt">In the older implementations (notably V7,</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:450pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">System III, and early System V), the handler for a given signal is reset to the default for that signal</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:462pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">whenever the handler &#xfb01;res.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:462pt;left:192pt"><span style="font-family:Times,serif;font-size:9.963pt">The result of sending two of the same signal in quick succession is</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:474pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">therefore usually to kill the process, no matter what handler was set.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:496pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">The BSD 4.x versions of Unix changed to &#x201c;reliable&#x201d; signals, which do not reset unless the user</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:508pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">explicitly requests it.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:508pt;left:164pt"><span style="font-family:Times,serif;font-size:9.963pt">They also introduced primitives to block or temporarily suspend processing</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:520pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">of a given set of signals.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:520pt;left:185pt"><span style="font-family:Times,serif;font-size:9.963pt">Modern Unixes support both styles.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:520pt;left:344pt"><span style="font-family:Times,serif;font-size:9.963pt">You should use the BSD-style</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:581pt;left:262pt"><span style="font-family:Times,serif;font-size:9.963pt">202</span></p>
</div>

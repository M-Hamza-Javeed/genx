<div id="page0" style="position:relative;width:540pt;height:648pt;background-color:white">
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:32pt;left:227pt"><span style="font-family:Times,serif;font-size:9.963pt">Chapter 5. Textuality</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:100pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">When you feel the urge to design a complex binary &#xfb01;le format, or a complex binary application</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:112pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">protocol, it is generally wise to lie down until the feeling passes. If performance is what you&#x2019;re</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:124pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">worried about, implementing compression on the text protocol stream either at some level below or</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:136pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">above the application protocol will give you a cleaner and perhaps better-performing design than a</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:148pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">binary protocol (text compresses well, and quickly).</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:169pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">A bad example of binary formats in Unix history was the way device-independent</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:181pt;left:108pt"><i><span style="font-family:Times,serif;font-size:9.963pt">troff</span></i><span style="font-family:Times,serif;font-size:9.963pt"> read a binary &#xfb01;le containing device information, supposedly for speed. The</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:193pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">initial implementation generated that binary &#xfb01;le from a text description in a</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:205pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">somewhat unportable way.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:205pt;left:227pt"><span style="font-family:Times,serif;font-size:9.963pt">Faced with a need to port</span><i><span style="font-family:Times,serif;font-size:9.963pt"> ditroff quickly</span></i><span style="font-family:Times,serif;font-size:9.963pt"> to a new</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:217pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">machine, rather than reinvent the binary goo, I ripped it out and just had</span><i><span style="font-family:Times,serif;font-size:9.963pt"> ditroff</span></i></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:229pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">read the text &#xfb01;le. With carefully crafted &#xfb01;le-reading code, the speed penalty was</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:241pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">negligible.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:253pt;left:422pt"><span style="font-family:Times,serif;font-size:9.963pt">&#x2014;</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:265pt;left:298pt"><span style="font-family:Times,serif;font-size:9.963pt;color:#ff0000">&lt;author&gt;HenrySpencer&lt;/author&gt;</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:286pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Designing a textual protocol tends to future-proof your system. One speci&#xfb01;c reason is that ranges on</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:298pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">numeric &#xfb01;elds aren&#x2019;t implied by the format itself. Binary formats usually specify the number of bits</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:310pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">allocated to a given value, and extending them is dif&#xfb01;cult.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:310pt;left:314pt"><span style="font-family:Times,serif;font-size:9.963pt">For example, IPv4 only allows 32 bits</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:322pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">for an address. To extend address size to 128 bits (as done by IPv6) requires a major revamping.</span><sup><span style="font-family:Times,serif;font-size:6.273pt">51</span></sup></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:334pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">In contrast, if you need a larger value in a text format, just write it. It may be that a given program</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:346pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">can&#x2019;t receive values in that range, but it&#x2019;s usually easier to modify the program than to modify all</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:358pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">the data stored in that format.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:380pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">The only good justi&#xfb01;cation for a binary protocol is if you&#x2019;re going to be manipulating large enough</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:392pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">data sets that you&#x2019;re genuinely worried about getting the most bit-density out of your media, or if</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:404pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">you&#x2019;re very concerned about the time or instruction budget required to interpret the data into an in-</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:416pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">core structure. Formats for large images and multimedia are sometimes an example of the former,</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:428pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">and network protocols with hard latency requirements sometimes an example of the latter.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:449pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">The reciprocal problem with SMTP or HTTP-like text protocols is that they tend</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:461pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">to be expensive in bandwidth and slow to parse.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:461pt;left:318pt"><span style="font-family:Times,serif;font-size:9.963pt">The smallest X request is 4</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:473pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">bytes: the smallest HTTP request is about 100 bytes.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:473pt;left:344pt"><span style="font-family:Times,serif;font-size:9.963pt">X requests, including</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:485pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">amortized overhead of transport, can be executed in the order of 100 instructions;</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:497pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">at one point, an Apache [web server] developer proudly indicated they were down</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:516pt;left:72pt"><span style="font-family:Times,serif;font-size:5.018pt">51</span><span style="font-family:Times,serif;font-size:7.97pt">There is a legend that some early airline reservation systems allocated exactly one byte for a plane&#x2019;s passenger count.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:526pt;left:72pt"><span style="font-family:Times,serif;font-size:7.97pt">Supposedly they became very confused by the arrival of the Boeing 747, the &#xfb01;rst plane that could carry more than 255</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:536pt;left:72pt"><span style="font-family:Times,serif;font-size:7.97pt">passengers.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:581pt;left:262pt"><span style="font-family:Times,serif;font-size:9.963pt">132</span></p>
</div>

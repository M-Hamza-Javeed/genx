<div id="page0" style="position:relative;width:540pt;height:648pt;background-color:white">
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:32pt;left:209pt"><span style="font-family:Times,serif;font-size:9.963pt">Chapter 7. Multiprogramming</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:100pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">interpreted as the locations of special &#xfb01;les analogous to bidirectional named pipes). As an example,</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:112pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">client programs and servers using the X windowing system typically use AF_LOCAL sockets to</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:124pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">communicate.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:146pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">All modern Unixes support BSD-style</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:146pt;left:238pt"><span style="font-family:Times,serif;font-size:9.963pt">sockets, and as a matter of design they are usually the</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:158pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">right thing to use for bidirectional IPC no matter where your cooperating processes are located.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:170pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Performance pressure may push you to use shared memory or temp&#xfb01;les or other techniques that</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:181pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">make stronger locality assumptions, but under modern conditions it is best to assume that your code</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:193pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">will need to be scaled up to distributed operation.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:193pt;left:284pt"><span style="font-family:Times,serif;font-size:9.963pt">More importantly, those locality assumptions</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:205pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">may mean that portions of your system get chummier with each others&#x2019; internals than ought to be</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:217pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">the case in a good design. The separation of address spaces that sockets enforce is a feature, not a</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:229pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">bug.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:251pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">To use sockets gracefully, in the Unix tradition, start by designing an</span><i><span style="font-family:Times,serif;font-size:9.963pt"> application protocol</span></i><span style="font-family:Times,serif;font-size:9.963pt"> for</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:263pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">use between them &#x2014; a set of requests and responses which expresses the semantics of what your</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:275pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">programs will be communicating about in a succinct way. We&#x2019;ve already discussed the some major</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:287pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">issues in the design of application protocols in Chapter 5.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:309pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Sockets are supported in all recent Unixes, under Windows, and under classic MacOS as well.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:331pt;left:72pt"><b><span style="font-family:Helvetica,sans-serif;font-size:10.959pt">Case Study: PostgreSQL</span></b></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:354pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">PostgreSQL is an open-source database program. Had it been implemented as a monster monolith,</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:366pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">it would be a single program with an interactive interface that manipulates database &#xfb01;les on disk</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:378pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">directly. Interface would be welded together with implementation, and two instances of the program</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:390pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">attempting to manipulate the same database at the same time would have serious contention and</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:402pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">locking issues.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:424pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Instead, the PostgreSQL suite includes a server called</span><i><span style="font-family:Times,serif;font-size:9.963pt"> postmaster</span></i><span style="font-family:Times,serif;font-size:9.963pt"> and at least three client applica-</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:436pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">tions. One</span><i><span style="font-family:Times,serif;font-size:9.963pt"> postmaster</span></i><span style="font-family:Times,serif;font-size:9.963pt"> server process per machine runs in background and has exclusive access to</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:448pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">the database &#xfb01;les. It accepts requests in the SQL query minilanguage through TCP/IP sockets, and</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:460pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">returns answers in a textual format as well.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:460pt;left:257pt"><span style="font-family:Times,serif;font-size:9.963pt">When the user runs a PostgreSQL client, that client</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:472pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">opens a session to</span><i><span style="font-family:Times,serif;font-size:9.963pt"> postmaster</span></i><span style="font-family:Times,serif;font-size:9.963pt"> and does SQL transactions with it.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:472pt;left:347pt"><span style="font-family:Times,serif;font-size:9.963pt">The server can handle several</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:484pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">client sessions at once, and sequences requests so that they don&#x2019;t interfere with each other.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:505pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Because the front end and back end are separate, the server doesn&#x2019;t need to know anything except</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:517pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">how to interpret SQL requests from a client and send SQL reports back to it.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:517pt;left:406pt"><span style="font-family:Times,serif;font-size:9.963pt">The clients, on</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:581pt;left:262pt"><span style="font-family:Times,serif;font-size:9.963pt">205</span></p>
</div>

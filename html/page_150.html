<div id="page0" style="position:relative;width:612pt;height:792pt;background-color:white">
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:95pt;left:108pt"><i><span style="font-family:BookAntiqua,serif;font-size:9pt">Unit Test, Stub, Spy, and Mock Your App</span></i></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:666pt;left:293pt"><b><span style="font-family:Arial,sans-serif;font-size:9pt">[</span></b><b><span style="font-family:Arial,sans-serif;font-size:8pt"> 134 </span></b><b><span style="font-family:Arial,sans-serif;font-size:9pt">]</span></b></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:115pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">Here, we stub the </span><span style="font-family:CourierStd,serif;font-size:9.5pt">getNameAsArray()</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt"> method of the </span><span style="font-family:CourierStd,serif;font-size:9.5pt">User</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt"> model and return an </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:127pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">empty array. So while you call the </span><span style="font-family:CourierStd,serif;font-size:9.5pt">getNameAsArray()</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt"> method, </span><i><span style="font-family:BookAntiqua,serif;font-size:10.5pt">not the method  </span></i></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:140pt;left:107pt"><i><span style="font-family:BookAntiqua,serif;font-size:10.5pt">but the stub will get called</span></i><span style="font-family:BookAntiqua,serif;font-size:10.5pt">. We made sure that the stub returns an empty array.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:161pt;left:107pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">Now the test is as simple as the one we did earlier. We just call the </span><span style="font-family:CourierStd,serif;font-size:9.5pt">getNameAsArray()</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt"> </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:174pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">method on the </span><span style="font-family:CourierStd,serif;font-size:9.5pt">User</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt"> instance and check the length of the returned value.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:205pt;left:108pt"><b><span style="font-family:Arial,sans-serif;font-size:18pt">Testing with mocks</span></b></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:236pt;left:129pt"><i><span style="font-family:BookAntiqua,serif;font-size:10.5pt">Mocks (and mock expectations) are fake methods (like spies) with pre-programmed </span></i></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:248pt;left:129pt"><i><span style="font-family:BookAntiqua,serif;font-size:10.5pt">behavior (like stubs) as well as pre-programmed expectations. A mock will fail your </span></i></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:261pt;left:129pt"><i><span style="font-family:BookAntiqua,serif;font-size:10.5pt">test if it is not used as expected.</span></i></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:283pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">This is the definition of mock as given in the </span><span style="font-family:CourierStd,serif;font-size:9.5pt">SinonJS</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt"> website (</span><span style="font-family:CourierStd,serif;font-size:9.5pt">http://sinonjs.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:295pt;left:107pt"><span style="font-family:CourierStd,serif;font-size:9.5pt">org/docs/#mocks</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt">). Mocks are quite similar to stubs, but they come with built-in </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:308pt;left:107pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">expectations. They implement both the spy and stub APIs. With a mock, you define </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:320pt;left:107pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">all the expectations that should happen in your test. When all those things are done, </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:333pt;left:107pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">you assert whether those things happened exactly the way they were planned. So </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:346pt;left:107pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">you define the expectations and if they aren&apos;t met, the test fails.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:367pt;left:107pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">Now, how do we use a mock? We mock an object, set expectations on its methods, </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:379pt;left:107pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">and apply modifiers on these expectations. Then we verify whether the test passes all </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:392pt;left:107pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">the expectations or not. To understand it better, let&apos;s explore a simple example with </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:405pt;left:107pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">mock, as shown in the following code snippet:</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:426pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">test(&apos;should call getNameAsArray once and check it is called on the </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:437pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">user model&apos;, function () {</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:449pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  this.user = new User({</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:461pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">    name: &apos;Subodh Guha&apos;</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:474pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  });</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:498pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  var mock = sinon.mock(this.user);</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:523pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  // We set the expectations here</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:535pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  mock.expects(&apos;getNameAsArray&apos;).once().on(this.user);</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:559pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  // Execution happens here</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:571pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  this.user.getNameAsArray();</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:596pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  // Now we verify whether the expectations are met or not</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:608pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  mock.verify();</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:620pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">});</span></p>
</div>

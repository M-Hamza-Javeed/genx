<div id="page0" style="position:relative;width:612pt;height:792pt;background-color:white">
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:95pt;left:468pt"><i><span style="font-family:BookAntiqua,serif;font-size:9pt">Chapter 8</span></i></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:666pt;left:293pt"><b><span style="font-family:Arial,sans-serif;font-size:9pt">[</span></b><b><span style="font-family:Arial,sans-serif;font-size:8pt"> 133 </span></b><b><span style="font-family:Arial,sans-serif;font-size:9pt">]</span></b></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:115pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">An anonymous stub can be defined as follows:</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:136pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">var stub = sinon.stub();</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:155pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">As a wrapper to a method of an object, it can be defined as follows:</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:177pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">var stub = sinon.stub(object, &quot;method&quot;);</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:196pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">Here the function </span><span style="font-family:CourierStd,serif;font-size:9.5pt">object.method</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt"> is replaced with an anonymous stub function. You </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:209pt;left:107pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">can also add one more function as the third parameter to the </span><span style="font-family:CourierStd,serif;font-size:9.5pt">stub()</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt"> function, which </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:221pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">will work as a spy on </span><span style="font-family:CourierStd,serif;font-size:9.5pt">object.method</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt"> and will replace the original method as follows:</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:243pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">var stub = sinon.stub(object, &quot;method&quot;, function(){});</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:262pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">To understand how a spy works with a real example, we can use the same </span><span style="font-family:CourierStd,serif;font-size:9.5pt">User</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt"> </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:275pt;left:107pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">model that we previously used. This is shown in the following code snippet:</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:296pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">// We will use the same User model definition here</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:321pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">module(&quot;Should work when getNameAsArray method is called&quot;, {</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:333pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  setup: function () {</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:345pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">    this.user = new User();</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:370pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">    // Use a stub to replace the getNameAsArray method</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:382pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">    this.userStub = sinon.stub(this.user, &quot;getNameAsArray&quot;);</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:394pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">    this.userStub.returns([]);</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:406pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  },</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:431pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  // Restore the original method</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:443pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  teardown: function () {</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:455pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">    this.userStub.restore();</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:467pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  }</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:480pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">});</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:504pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">test(&apos;should call getNameAsArray and must return an empty array&apos;,  </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:515pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  function () {</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:527pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  this.user.getNameAsArray();</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:552pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  // Should return an empty array</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:564pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  equal(_.isArray(this.user.getNameAsArray.returnValues[0]),  </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:575pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  true);</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:587pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  equal(this.user.getNameAsArray.returnValues[0].length, 0);</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:599pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">});</span></p>
</div>

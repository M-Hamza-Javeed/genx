<div id="page0" style="position:relative;width:540pt;height:648pt;background-color:white">
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:32pt;left:225pt"><span style="font-family:Times,serif;font-size:9.963pt">Chapter 9. Generation</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:100pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">The better way would be data-driven programming &#x2014; code that would analyze the shape and</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:112pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">members of the initializer, query the class de&#xfb01;nitions themselves about their members, and then</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:124pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">impedance-match the two sets.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:146pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Lisp and Java programmers call this</span><i><span style="font-family:Times,serif;font-size:9.963pt"> introspection</span></i><span style="font-family:Times,serif;font-size:9.963pt">; in some other object-oriented languages it&#x2019;s</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:158pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">called</span><i><span style="font-family:Times,serif;font-size:9.963pt"> metaclass hacking</span></i><span style="font-family:Times,serif;font-size:9.963pt"> and is generally considered fearsomely esoteric, deep black magic. Most</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:170pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">object-oriented languages don&#x2019;t support it at all; in those that do (Perl and Java among them), it tends</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:181pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">to be a complicated and fragile undertaking. But Python&#x2019;s facilities for introspection and metaclass</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:193pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">hacking are unusually accessible.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:215pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">See Example 9.3 for the solution code, from near line 1895 of the 1.43 version.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:238pt;left:72pt"><b><span style="font-family:Times,serif;font-size:11.955pt">Example 9.3.</span></b><tt><b><span style="font-family:Courier,monospace;font-size:10.76pt"> copy_instance</span></b></tt><b><span style="font-family:Times,serif;font-size:11.955pt"> metaclass code.</span></b></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:273pt;left:72pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt">def copy_instance(toclass, fromdict):</span></tt></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:284pt;left:72pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt"># Make a class object of given type from a conformant dictionary.</span></tt></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:295pt;left:87pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt">class_sig = toclass.__dict__.keys(); class_sig.sort()</span></tt></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:306pt;left:87pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt">dict_keys = fromdict.keys(); dict_keys.sort()</span></tt></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:316pt;left:87pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt">common = set_intersection(class_sig, dict_keys)</span></tt></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:327pt;left:87pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt">if &#x2019;typemap&#x2019; in class_sig:</span></tt></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:338pt;left:102pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt">class_sig.remove(&#x2019;typemap&#x2019;)</span></tt></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:349pt;left:87pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt">if tuple(class_sig) != tuple(dict_keys):</span></tt></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:359pt;left:102pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt">print &quot;Conformability error&quot;</span></tt></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:370pt;left:72pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt">#</span></tt></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:370pt;left:107pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt">print &quot;Class signature: &quot; + &#x2018;class_sig&#x2018;</span></tt></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:381pt;left:72pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt">#</span></tt></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:381pt;left:107pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt">print &quot;Dictionary keys: &quot; + &#x2018;dict_keys&#x2018;</span></tt></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:392pt;left:102pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt">print &quot;Not matched in class signature: &quot;+ \</span></tt></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:402pt;left:224pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt">&#x2018;set_diff(class_sig, common)&#x2018;</span></tt></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:413pt;left:102pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt">print &quot;Not matched in dictionary keys: &quot;+ \</span></tt></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:424pt;left:224pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt">&#x2018;set_diff(dict_keys, common)&#x2018;</span></tt></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:435pt;left:102pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt">sys.exit(1)</span></tt></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:445pt;left:87pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt">else:</span></tt></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:456pt;left:102pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt">for x in dict_keys:</span></tt></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:467pt;left:117pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt">setattr(toclass, x, fromdict[x])</span></tt></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:497pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Most of this code is error-checking against the possibility that the class members and</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:509pt;left:72pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt">--configdump</span></tt><span style="font-family:Times,serif;font-size:9.963pt"> report generation have drifted out of synchronization.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:509pt;left:381pt"><span style="font-family:Times,serif;font-size:9.963pt">It ensures that if the</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:521pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">code breaks, the breakage will be detected early &#x2014; an implementation of the Rule of Repair. The</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:581pt;left:262pt"><span style="font-family:Times,serif;font-size:9.963pt">257</span></p>
</div>

<div id="page0" style="position:relative;width:540pt;height:648pt;background-color:white">
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:32pt;left:219pt"><span style="font-family:Times,serif;font-size:9.963pt">Chapter 12. Optimization</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:100pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">is, don&#x2019;t try to precompute expensive operations unless you have a throughput requirement and know</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:112pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">by actual measurement that the throughput you are getting is too low. Precomputation may seem</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:124pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">ef&#xfb01;cient because it minimizes total use of processor cycles, but processor cycles are cheap. Unless</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:136pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">you are doing one of a handful of monstrously compute-intensive applications like data mining,</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:148pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">animation rendering, or the aforementioned bomb simulations, it is usually better to opt for short</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:160pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">startup times and quick response.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:181pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">In Unix&#x2019;s early days this advice might have been considered heretical. Processors were much slower</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:193pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">and cost ratios were very different then; also, the pattern of Unix use was tilted rather more strongly</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:205pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">toward server operations. The point about the value of low latency needs to be made partly because</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:217pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">even newer Unix developers sometimes inherit an old-time cultural prejudice toward optimizing for</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:229pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">throughput. But times have changed.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:251pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Three general strategies for reducing latency are (a) batching transactions that can share startup</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:263pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">costs, (b) allowing transactions to overlap, and (c) caching.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:285pt;left:72pt"><b><span style="font-family:Helvetica,sans-serif;font-size:13.948pt">Batching Operations</span></b></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:312pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Graphics APIs are frequently written on the assumption that the &#xfb01;xed setup cost for a physical screen</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:324pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">update is large.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:324pt;left:141pt"><span style="font-family:Times,serif;font-size:9.963pt">Consequently, the write operations actually modify an internal buffer.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:324pt;left:429pt"><span style="font-family:Times,serif;font-size:9.963pt">It is up to</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:336pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">the programmer to decide when enough of these updates have been batched and to issue the call that</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:348pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">turns them into a physical screen update. Picking the right spacing of physical updates can make a</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:360pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">great deal of difference to the feel of the graphics client. Both the X server and the curses(3) library</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:372pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">used by roguelike programs are organized in this way.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:393pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Persistent service daemons are a more Unix-speci&#xfb01;c example of batching.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:393pt;left:376pt"><span style="font-family:Times,serif;font-size:9.963pt">There are two reasons,</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:405pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">one obvious and one subtle, to write persistent daemons (as opposed to CLI servers that are started</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:417pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">up fresh for each session).</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:417pt;left:188pt"><span style="font-family:Times,serif;font-size:9.963pt">The obvious reason is to manage updates to a shared resource.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:417pt;left:452pt"><span style="font-family:Times,serif;font-size:9.963pt">The</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:429pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">less obvious reason, which obtains even for daemons that don&#x2019;t handle updates, is to amortize the</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:441pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">cost of reading in the daemon&#x2019;s database across multiple requests. A perfect example of this is the</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:453pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">DNS service daemon named(8), which must sometimes handle thousands of requests per second,</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:465pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">each one of which may actually be blocking a user&#x2019;s Web page load. One of the tactics that makes</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:477pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">named(8) fast is that it replaces parses of expensive on-disk text &#xfb01;les describing DNS zones with</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:489pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">accesses to a cache held in memory.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:511pt;left:72pt"><b><span style="font-family:Helvetica,sans-serif;font-size:13.948pt">Overlapping Operations</span></b></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:581pt;left:262pt"><span style="font-family:Times,serif;font-size:9.963pt">332</span></p>
</div>

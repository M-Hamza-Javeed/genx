<div id="page0" style="position:relative;width:540pt;height:648pt;background-color:white">
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:32pt;left:209pt"><span style="font-family:Times,serif;font-size:9.963pt">Chapter 7. Multiprogramming</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:100pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Though Unix developers have long been comfortable with computation by multiple cooperating</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:112pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">processes, they do not have a native tradition of using threads (processes that share their entire</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:124pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">address spaces).</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:124pt;left:147pt"><span style="font-family:Times,serif;font-size:9.963pt">These are a recent import from elsewhere, and the fact that Unix programmers</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:136pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">generally dislike them is not merely accident or historical contingency.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:158pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">From a complexity-control point of view, threads are a bad substitute for lightweight processes with</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:170pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">their own address spaces; the idea of threads is native to operating systems with expensive process-</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:181pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">spawning and weak IPC facilities.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:203pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">By de&#xfb01;nition, though daughter threads of a process typically have separate local-variable stacks,</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:215pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">they share the same global memory. The task of managing contentions and critical regions in this</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:227pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">shared address space is quite dif&#xfb01;cult and a fertile source of global complexity and bugs. It can be</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:239pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">done, but as the complexity of one&#x2019;s locking regime rises, the chance of races and deadlocks due to</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:251pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">unanticipated interactions rises correspondingly.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:273pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Threads are a fertile source of bugs because they can too easily know too much about each others&#x2019;</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:285pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">internal states.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:285pt;left:142pt"><span style="font-family:Times,serif;font-size:9.963pt">There is no automatic encapsulation, as there would be between processes with</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:297pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">separate address spaces that must do explicit IPC to communicate. Thus, threaded programs suffer</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:309pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">from not just ordinary contention problems, but from entire new categories of timing-dependent</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:321pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">bugs that are excruciatingly dif&#xfb01;cult to even reproduce, let alone &#xfb01;x.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:343pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Thread developers have been waking up to this problem.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:343pt;left:322pt"><span style="font-family:Times,serif;font-size:9.963pt">Recent thread implementations and</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:355pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">standards show an increasing concern with providing thread-local storage, which is intended to limit</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:367pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">problems arising from the shared global address space.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:367pt;left:300pt"><span style="font-family:Times,serif;font-size:9.963pt">As threading APIs move in this direction,</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:379pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">thread programming starts to look more and more like a controlled use of shared memory.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:401pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">Threads often prevent abstraction. In order to prevent deadlock, you often need to</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:413pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">know how and if the library you are using uses threads in order to avoid deadlock</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:425pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">problems.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:425pt;left:155pt"><span style="font-family:Times,serif;font-size:9.963pt">Similarly, the use of threads in a library could be affected by the use</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:437pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">of threads at the application layer.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:448pt;left:422pt"><span style="font-family:Times,serif;font-size:9.963pt">&#x2014;</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:460pt;left:311pt"><span style="font-family:Times,serif;font-size:9.963pt;color:#ff0000">&lt;author&gt;DavidKorn&lt;/author&gt;</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:482pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">To add insult to injury, threading has performance costs that erode its advantages over conventional</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:494pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">process partitioning.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:494pt;left:166pt"><span style="font-family:Times,serif;font-size:9.963pt">While threading can get rid of some of the overhead of rapidly switching</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:506pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">process contexts, locking shared data structures so threads won&#x2019;t step on each other can be just as</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:518pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">expensive.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:581pt;left:262pt"><span style="font-family:Times,serif;font-size:9.963pt">212</span></p>
</div>

<div id="page0" style="position:relative;width:540pt;height:648pt;background-color:white">
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:32pt;left:209pt"><span style="font-family:Times,serif;font-size:9.963pt">Chapter 7. Multiprogramming</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:100pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">memory; this is mostly a hint to the operating system that it need not &#xfb02;ush the pseudo&#xfb01;le data to</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:112pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">disk.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:134pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Because access to shared memory is not automatically serialized by a discipline resembling read</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:146pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">and write calls, programs doing the sharing must handle contention and deadlock issues themselves,</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:158pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">typically by using semaphore variables located in the shared segment. The issues here resemble</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:170pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">those in multithreading (see the end of this chapter for discussion) but are more manageable because</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:181pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">default is</span><i><span style="font-family:Times,serif;font-size:9.963pt"> not</span></i><span style="font-family:Times,serif;font-size:9.963pt"> to share memory. Thus, problems are better contained.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:203pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">On systems where it is available and reliable, the Apache web server&#x2019;s scoreboard facility uses</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:215pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">shared memory for communication between an Apache master process and the load-sharing pool</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:227pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">of Apache images that it manages. Modern X implementations also use shared memory, to pass</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:239pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">large images between client and server when they are resident on the same machine, to avoid the</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:251pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">overhead of socket communication. Both uses are performance hacks justi&#xfb01;ed by experience and</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:263pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">testing, rather than being architectural choices.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:285pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">The mmap(2) call is supported under all modern Unixes, including Linux and the open-source BSD</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:297pt;left:74pt"><span style="font-family:Times,serif;font-size:9.963pt">versions; this is described in the Single Unix Speci&#xfb01;cation. It will not normally be available under</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:309pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Windows, MacOS classic, and other operating systems.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:331pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Before purpose-built mmap(2) was available, a common way for two processes to communicate</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:343pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">was for them to open the same &#xfb01;le, and then delete that &#xfb01;le.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:343pt;left:326pt"><span style="font-family:Times,serif;font-size:9.963pt">The &#xfb01;le wouldn&#x2019;t go away until all</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:355pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">open &#xfb01;lehandles were closed, but some old Unixes took the link count falling to zero as a hint that</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:367pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">they could stop updating the on-disk copy of the &#xfb01;le.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:367pt;left:296pt"><span style="font-family:Times,serif;font-size:9.963pt">The downside was that your backing store</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:379pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">was the &#xfb01;le system rather than a swap device, the &#xfb01;le system the deleted &#xfb01;le lived on couldn&#x2019;t be</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:391pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">unmounted until the programs using it closed, and attaching new processes to an existing shared</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:403pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">memory segment faked up in this way was tricky at best.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:425pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">After Version 7 and the split between the BSD and System V lineages, the evolution of Unix</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:437pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">interprocess communication took two different directions. The BSD direction led to sockets. The</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:448pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">AT&amp;T lineage, on the other hand, developed named pipes (as previously discussed) and an IPC</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:460pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">facility, speci&#xfb01;cally designed for passing binary data and based on shared-memory bidirectional</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:472pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">message queues. This is called &#x2018;System V IPC&#x2019;&#x2014;or, among old timers, &#x2018;Indian Hill&#x2019; IPC after the</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:484pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">AT&amp;T facility where it was &#xfb01;rst written.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:506pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">The upper, message-passing layer of System V IPC has largely fallen out of use.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:506pt;left:426pt"><span style="font-family:Times,serif;font-size:9.963pt">The lower</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:518pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">layer, which consists of shared memory and semaphores, still has signi&#xfb01;cant applications under</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:530pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">circumstances in which one needs to do mutual-exclusion locking and some global data sharing</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:581pt;left:262pt"><span style="font-family:Times,serif;font-size:9.963pt">207</span></p>
</div>

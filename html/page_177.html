<div id="page0" style="position:relative;width:540pt;height:648pt;background-color:white">
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:32pt;left:221pt"><span style="font-family:Times,serif;font-size:9.963pt">Chapter 6. Transparency</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:100pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">examine, and modify the terminfo database; no special ones (other than tic(1) and infocmp(1) for</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:112pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">packing and unpacking the individual records) need to be written and debugged. It also means that</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:124pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">work on speeding up database access would be work on speeding up the &#xfb01;le system itself, tuning</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:136pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">that would bene&#xfb01;t many more applications than just users of curses(3).</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:158pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">There is one additional advantage of this organization that doesn&#x2019;t come up in the terminfo case; you</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:170pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">get to use Unix&#x2019;s permissions mechanism rather than having to invent your own access-control layer</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:181pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">with its own bugs. This falls out as a consequence of adopting the &#x201c;everything is a &#xfb01;le&#x201d; philosophy</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:193pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">of Unix rather than trying to &#xfb01;ght it.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:215pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">The terminfo directory layout is rather space-inef&#xfb01;cient on most Unix &#xfb01;le systems. The entries are</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:227pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">usually between 400 and 1400 bytes long, but &#xfb01;le systems normally allocate a minimum of 4K for</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:239pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">every nonempty disk &#xfb01;le. The designers accepted this cost for the same reason they chose a packed</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:251pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">binary format, to cut the startup latency of terminfo-using programs to a minimum. Disk capacity</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:263pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">for constant price has exploded over a thousandfold since, tending to vindicate that decision.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:285pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">The contrast with the formats used by the Microsoft Windows registry &#xfb01;les is instructive. Registries</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:297pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">are property databases used by both Windows itself and applications.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:297pt;left:364pt"><span style="font-family:Times,serif;font-size:9.963pt">Each registry lives in one</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:309pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">big &#xfb01;le.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:309pt;left:114pt"><span style="font-family:Times,serif;font-size:9.963pt">Registries contain a mix of text and binary data that requires specialized editing tools.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:321pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">The one-big-&#xfb01;le approach leads, among other things, to the notorious &#x2018;registry creep&#x2019; phenomenon;</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:333pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">average access time rises without bound as new entries are added. Because there is no standard API</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:345pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">for editing the registry provided by the system, applications use ad-hoc code to edit it themselves,</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:357pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">making it notoriously subject to corruption that can lock up the entire system.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:379pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Using the Unix &#xfb01;le system as a database is a tactic other applications with simple database</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:391pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">requirements might do well to emulate. Good reasons not to do it are more likely to have to do</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:403pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">with the database keys not naturally looking like &#xfb01;lenames than they are with any performance</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:415pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">problems. In any case, it&#x2019;s the sort of good fast hack that can be very useful in prototyping.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:437pt;left:72pt"><b><span style="font-family:Helvetica,sans-serif;font-size:13.948pt">Case Study: Freeciv Data Files</span></b></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:463pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Freeciv is an open-source strategy game inspired by Sid Meier&#x2019;s classic</span><i><span style="font-family:Times,serif;font-size:9.963pt"> Civilization II</span></i><span style="font-family:Times,serif;font-size:9.963pt">. In it, each</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:475pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">player begins with a wandering band of neolithic nomads and builds a civilization. Player civiliza-</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:487pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">tions may explore and colonize the world, &#xfb01;ght wars, engage in trade, and research technological</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:499pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">advances. Some players may actually be arti&#xfb01;cial intelligences; solitaire play against these can be</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:511pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">challenging. One wins either by conquering the world or by being the &#xfb01;rst player to reach a tech-</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:523pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">nology level suf&#xfb01;cient to get a starship to Alpha Centauri. Sources and documentation are available</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:535pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">at the project site [http://www.freeciv.org/].</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:581pt;left:262pt"><span style="font-family:Times,serif;font-size:9.963pt">176</span></p>
</div>

<div id="page0" style="position:relative;width:540pt;height:648pt;background-color:white">
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:32pt;left:209pt"><span style="font-family:Times,serif;font-size:9.963pt">Chapter 7. Multiprogramming</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:100pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">application protocol over sockets, but very little about the design pattern would change if they used</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:112pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">any other bidirectional IPC method.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:134pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">This kind of partitioning is particularly effective in situations where multiple instances of the</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:146pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">application must manage access to resources that are shared among all. A single server process</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:158pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">may manage all resource contention, or cooperating peers may each take responsibility for some</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:170pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">critical resource.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:191pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Client-server partitioning can also help distribute cycle-hungry applications across multiple hosts.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:203pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Or it may make them suitable for distributed computing across the Internet (as with Freeciv). We&#x2019;ll</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:215pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">discuss the related</span><i><span style="font-family:Times,serif;font-size:9.963pt"> CLI server</span></i><span style="font-family:Times,serif;font-size:9.963pt"> pattern in Chapter 11.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:237pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Because all these peer-to-peer IPC techniques are alike at some level, we should evaluate them</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:249pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">mainly on the amount of program-complexity overhead they incur, and how much opacity they</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:261pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">introduce into our designs.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:261pt;left:189pt"><span style="font-family:Times,serif;font-size:9.963pt">This, ultimately, is why BSD sockets have won over other Unix IPC</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:273pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">methods, and why RPC has generally failed to get much traction.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:295pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Threads are fundamentally different.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:295pt;left:238pt"><span style="font-family:Times,serif;font-size:9.963pt">Rather than supporting communication among different</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:307pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">programs, they support a sort of timesharing within an instance of a single program.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:307pt;left:421pt"><span style="font-family:Times,serif;font-size:9.963pt">Rather than</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:319pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">being a way to partition a big program into smaller ones with simpler behavior, threading is strictly</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:331pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">a performance hack. It has all the problems normally associated with performance hacks, and a few</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:343pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">special ones of its own.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:365pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Accordingly, while we should seek ways to break up large programs into simpler cooperating</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:377pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">processes, the use of threads within processes should be a last resort rather than a &#xfb01;rst. Often, you</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:389pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">may &#xfb01;nd you can avoid them. If you can use limited shared memory and semaphores, asynchronous</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:401pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">I/O using</span><tt><span style="font-family:Courier,monospace;font-size:8.966pt"> SIGIO</span></tt><span style="font-family:Times,serif;font-size:9.963pt">, or poll(2)/select(2) rather than threading, do it that way.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:401pt;left:388pt"><span style="font-family:Times,serif;font-size:9.963pt">Keep it simple; use</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:413pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">techniques earlier on this list and lower on the complexity scale in preference to later ones.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:435pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">The combination of threads, remote-procedure-call interfaces, and heavyweight object-oriented</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:446pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">design is especially dangerous.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:446pt;left:213pt"><span style="font-family:Times,serif;font-size:9.963pt">Used sparingly and tastefully, any of these techniques can be</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:458pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">valuable &#x2014; but if you are ever invited onto a project that is supposed to feature all three, &#xfb02;eeing in</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:470pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">terror might well be an appropriate reaction.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:492pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">We have previously observed that programming in the real world is all about managing complexity.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:504pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Tools to manage complexity are good things.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:504pt;left:264pt"><span style="font-family:Times,serif;font-size:9.963pt">But when the effect of those tools is to proliferate</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:516pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">complexity rather than to control it, we would be better off throwing them away and starting from</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:528pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">zero. An important part of the Unix wisdom is to never forget this.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:581pt;left:262pt"><span style="font-family:Times,serif;font-size:9.963pt">214</span></p>
</div>

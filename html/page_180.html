<div id="page0" style="position:relative;width:540pt;height:648pt;background-color:white">
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:32pt;left:221pt"><span style="font-family:Times,serif;font-size:9.963pt">Chapter 6. Transparency</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:100pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">In Chapter 7 we&#x2019;ll exhibit the Freeciv strategy game as an example of client-server partitioning, with</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:112pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">the server maintaining shared state and the client concentrating on GUI presentation. But this game</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:124pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">has another notable architectural feature; much of the game&#x2019;s &#xfb01;xed data, rather than being wired into</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:136pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">the server code, is expressed in a property registry read in by the game server at startup time.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:158pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">The game&#x2019;s registry &#xfb01;les are written in a textual data-&#xfb01;le format that assembles text strings (with</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:170pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">associated text and numeric properties) into various internal lists of important data (such as nations</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:181pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">and unit types) in the game server. The minilanguage has an include directive, so game data can be</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:193pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">broken up into semantic units (different &#xfb01;les) that are each separately editable. This design choice</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:205pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">has been carried through to such an extent that it&#x2019;s possible to de&#xfb01;ne new nations and new unit types</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:217pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">simply by creating new declarations in the data &#xfb01;les, without touching the server code at all.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:239pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">The Freeciv server&#x2019;s startup parsing has an interesting feature that creates something of a con&#xfb02;ict</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:251pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">between two of Unix&#x2019;s design rules, and is therefore worth closer examination. The server ignores</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:263pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">property names it doesn&#x2019;t know how to use. This makes it possible to declare properties that the</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:275pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">server doesn&#x2019;t yet use without breaking the startup parsing. It means that development of the game</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:287pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">data (policy) and the server engine (mechanism) can be cleanly separated. On the other hand, it also</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:299pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">means startup parsing won&#x2019;t catch simple misspellings of attribute names. This quiet failure seems</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:311pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">to violate the Rule of Repair.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:333pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">To resolve this con&#xfb02;ict, notice that it&#x2019;s the server&#x2019;s job to</span><i><span style="font-family:Times,serif;font-size:9.963pt"> use</span></i><span style="font-family:Times,serif;font-size:9.963pt"> the registry data, but the task of</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:345pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">carefully error-checking that data could be handed off to another program to be run by human editors</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:357pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">each time the registry is modi&#xfb01;ed.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:357pt;left:219pt"><span style="font-family:Times,serif;font-size:9.963pt">One Unix solution would be a separate auditing program that</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:369pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">analyzes either a machine-readable speci&#xfb01;cation of the ruleset format or the source of the server</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:381pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">code to determine the set of properties it uses, parses the Freeciv registry to determine the set of</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:393pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">properties it provides, and prepares a difference report.</span><sup><span style="font-family:Times,serif;font-size:6.273pt">62</span></sup></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:415pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">The aggregate of all Freeciv data &#xfb01;les is functionally similar to a Windows registry, and even uses</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:427pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">a syntax resembling the textual portions of registries.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:427pt;left:296pt"><span style="font-family:Times,serif;font-size:9.963pt">But the creep and corruption problems we</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:439pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">noted with the Windows registry don&#x2019;t crop up here because no program (either within or outside the</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:450pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Freeciv suite)</span><i><span style="font-family:Times,serif;font-size:9.963pt"> writes</span></i><span style="font-family:Times,serif;font-size:9.963pt"> to these &#xfb01;les. It&#x2019;s a read-only registry edited only by the game&#x2019;s maintainers.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:472pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">The performance impact of data-&#xfb01;le parsing is minimized because for each &#xfb01;le the operation is</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:484pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">performed only once, at either client or server startup time.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:514pt;left:72pt"><span style="font-family:Times,serif;font-size:5.018pt">62</span><span style="font-family:Times,serif;font-size:7.97pt">The ur-ancestor of such validator programs under Unix was</span><i><span style="font-family:Times,serif;font-size:7.97pt"> lint</span></i><span style="font-family:Times,serif;font-size:7.97pt">, a validator for C code separate from the C compiler.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:523pt;left:72pt"><span style="font-family:Times,serif;font-size:7.97pt">Though GCC has absorbed its functions, old Unix hands are still apt to refer to the process of running a validator as &#x2018;linting&#x2019;,</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:533pt;left:72pt"><span style="font-family:Times,serif;font-size:7.97pt">and the name survives in utilities such as</span><i><span style="font-family:Times,serif;font-size:7.97pt"> xmllint</span></i><span style="font-family:Times,serif;font-size:7.97pt">.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:581pt;left:262pt"><span style="font-family:Times,serif;font-size:9.963pt">179</span></p>
</div>

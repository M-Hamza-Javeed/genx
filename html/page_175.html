<div id="page0" style="position:relative;width:540pt;height:648pt;background-color:white">
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:32pt;left:221pt"><span style="font-family:Times,serif;font-size:9.963pt">Chapter 6. Transparency</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:96pt;left:72pt"><b><span style="font-family:Helvetica,sans-serif;font-size:13.948pt">Case Study: The Terminfo Database</span></b></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:122pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">The terminfo database is a collection of descriptions of video-display terminals.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:122pt;left:423pt"><span style="font-family:Times,serif;font-size:9.963pt">Each entry</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:134pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">describes the escape sequences that perform various manipulations on the terminal screen, such</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:146pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">as inserting or deleting lines, erasing from the cursor position to end of line or screen, or beginning</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:158pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">and ending screen highlights such as reverse video, underline, or blink.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:180pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">The terminfo database is primarily used by the curses(3) libraries. These underlie the &#x201c;roguelike&#x201d;</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:192pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">interface style we discuss in Chapter 11, and some very widely used programs such as mutt(1),</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:204pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">lynx(1), and slrn(1). Though the terminal emulators such as xterm(1) that run on today&#x2019;s bitmapped</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:216pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">displays all have capabilities that are minor variations on those of the ANSI X3.64 standard and</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:228pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">the venerable VT100 terminal, there is still enough variation that hardwiring ANSI capabilities</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:239pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">into applications would be a bad idea.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:239pt;left:242pt"><span style="font-family:Times,serif;font-size:9.963pt">Terminfo is also worth studying because problems that</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:251pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">are logically similar to the one it addressed arise constantly in managing other kinds of peripheral</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:263pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">hardware that doesn&#x2019;t have a standard way to report their own capabilities.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:285pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">The design of terminfo bene&#xfb01;ts from experience with an earlier capability format called termcap.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:297pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">The database of termcap descriptions lived in a textual format in one big &#xfb01;le,</span><tt><span style="font-family:Courier,monospace;font-size:8.966pt"> /etc/termcap</span></tt><span style="font-family:Times,serif;font-size:9.963pt">;</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:309pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">though this format is now obsolete, your Unix system almost certainly includes a copy.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:331pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Normally, the key used to look up your terminal type entry is the environment variable</span><tt><span style="font-family:Courier,monospace;font-size:8.966pt"> TERM</span></tt><span style="font-family:Times,serif;font-size:9.963pt">, which</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:339pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">for purposes of this case study is set by magic.</span><sup><span style="font-family:Times,serif;font-size:6.273pt">61</span></sup><sup><span style="font-family:Times,serif;font-size:9.963pt"> </span></sup><span style="font-family:Times,serif;font-size:9.963pt">Applications that use terminfo (or termcap) pay a</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:355pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">small penalty in startup lag; when the curses(3) library initializes itself, it has to look up the entry</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:367pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">corresponding to</span><tt><span style="font-family:Courier,monospace;font-size:8.966pt"> TERM</span></tt><span style="font-family:Times,serif;font-size:9.963pt"> and load the entry into memory.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:389pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Experience with termcap showed that the startup penalty was dominated by the time required to</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:401pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">parse the textual representation of capabilities. Accordingly, terminfo entries are binary structure</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:413pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">dumps that can be marshaled and unmarshaled more quickly. There is a master textual format for</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:425pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">the entire database, the terminfo capability &#xfb01;le. That &#xfb01;le (or individual entries) can be compiled to</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:437pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">binary form with the terminfo compiler tic(1); binary entries can be decompiled to the editable text</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:449pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">format by infocmp(1).</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:471pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">The design super&#xfb01;cially contradicts the advice we gave in Chapter 5 against binary caches, but this</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:483pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">is actually the extreme case in which that&#x2019;s a good tactic.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:483pt;left:315pt"><span style="font-family:Times,serif;font-size:9.963pt">Edits to the text masters are very rare</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:495pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">&#x2014; in fact, Unixes normally ship with the terminfo database precompiled and the text master serving</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:514pt;left:72pt"><span style="font-family:Times,serif;font-size:5.018pt">61</span><span style="font-family:Times,serif;font-size:7.97pt">Actually,</span><tt><span style="font-family:Courier,monospace;font-size:7.173pt"> TERM</span></tt><span style="font-family:Times,serif;font-size:7.97pt"> is set by the system at login time. For actual terminals on serial lines, the mapping from tty lines to</span><tt><span style="font-family:Courier,monospace;font-size:7.173pt"> TERM</span></tt></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:524pt;left:72pt"><span style="font-family:Times,serif;font-size:7.97pt">values is set from a system con&#xfb01;guration &#xfb01;le at boot time; the details vary among Unixes. Terminal emulators like xterm(1)</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:533pt;left:72pt"><span style="font-family:Times,serif;font-size:7.97pt">set this variable themselves.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:581pt;left:262pt"><span style="font-family:Times,serif;font-size:9.963pt">174</span></p>
</div>

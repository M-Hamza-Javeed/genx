<div id="page0" style="position:relative;width:612pt;height:792pt;background-color:white">
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:95pt;left:468pt"><i><span style="font-family:BookAntiqua,serif;font-size:9pt">Chapter 6</span></i></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:666pt;left:293pt"><b><span style="font-family:Arial,sans-serif;font-size:9pt">[</span></b><b><span style="font-family:Arial,sans-serif;font-size:8pt"> 101 </span></b><b><span style="font-family:Arial,sans-serif;font-size:9pt">]</span></b></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:115pt;left:125pt"><span style="font-family:CourierStd,serif;font-size:9pt">    return this;  </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:127pt;left:125pt"><span style="font-family:CourierStd,serif;font-size:9pt">  }</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:139pt;left:125pt"><span style="font-family:CourierStd,serif;font-size:9pt">});</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:164pt;left:125pt"><span style="font-family:CourierStd,serif;font-size:9pt">var myView = new MyView();</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:176pt;left:125pt"><span style="font-family:CourierStd,serif;font-size:9pt">$(document.body).append(myView.render().el);</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:200pt;left:125pt"><span style="font-family:CourierStd,serif;font-size:9pt">myView.model.set(&apos;name&apos;, &apos;Arup&apos;);</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:213pt;left:125pt"><span style="font-family:CourierStd,serif;font-size:9pt">myView.remove();</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:232pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">Now, as you can see, we registered a </span><span style="font-family:CourierStd,serif;font-size:9.5pt">change</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt"> event on the model so that whenever </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:245pt;left:107pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">any of its attributes change, the </span><span style="font-family:CourierStd,serif;font-size:9.5pt">render</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt"> method will be called. Then we created an </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:257pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">instance of the view, changed the </span><span style="font-family:CourierStd,serif;font-size:9.5pt">name</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt"> attribute of the model, and destroyed the </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:270pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">view. The </span><span style="font-family:CourierStd,serif;font-size:9.5pt">remove()</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt"> method destroys the </span><span style="font-family:CourierStd,serif;font-size:9.5pt">view</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt"> instance and removes the view from </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:282pt;left:107pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">the DOM.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:304pt;left:107pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">The whole process works as expected, though with a slight problem. When you </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:316pt;left:107pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">create a view in JavaScript, you create DOM nodes and bind event listeners to them. </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:329pt;left:107pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">When you remove nodes from the DOM, their event listeners hold references to </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:341pt;left:107pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">them. As a result, your JavaScript engine will not automatically garbage collect the </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:354pt;left:107pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">nodes as there are still references to them in the scope. In our case too, even if the </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:367pt;left:107pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">view is destroyed, the </span><span style="font-family:CourierStd,serif;font-size:9.5pt">change</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt"> event listener on the model persists and we need to </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:379pt;left:107pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">take care of it explicitly. How can we do this? We can add a </span><span style="font-family:CourierStd,serif;font-size:9.5pt">close()</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt"> method to the </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:392pt;left:107pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">view and unbind all such events in this method before destroying the view:</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:413pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">close: function () {</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:425pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  this.model.off(&apos;change&apos;, this.render, this);</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:438pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  this.remove();</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:450pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">}</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:469pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">Now everything is cleaned up properly. But do we need to keep doing this for all of </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:482pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">our views? No, because Backbone V9.9 introduced a </span><span style="font-family:CourierStd,serif;font-size:9.5pt">listenTo()</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt"> method that tells </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:494pt;left:107pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">an object to listen to an event of another object:</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:516pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">this.listenTo(this.model, &apos;change&apos;, this.render);</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:535pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">This works exactly the same way, but the advantage of this over the </span><span style="font-family:CourierStd,serif;font-size:9.5pt">on()</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt"> method </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:548pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">is that it allows the object to keep track of events, and they can be removed all at </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:560pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">once later on. So, we will not need an extra </span><span style="font-family:CourierStd,serif;font-size:9.5pt">close()</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt"> method to unbind all the events </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:573pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">before destroying the view. Rather, the </span><span style="font-family:CourierStd,serif;font-size:9.5pt">remove()</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt"> method of Backbone view will now </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:585pt;left:107pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">clean up any bound event by calling the </span><span style="font-family:CourierStd,serif;font-size:9.5pt">stopListening()</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt"> method.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:607pt;left:107pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">So, use the </span><span style="font-family:CourierStd,serif;font-size:9.5pt">on()</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt"> method when you want to take care of the handler yourself and </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:619pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">where scenarios like event cleanup or zombie handling will not arise. Otherwise, go </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:632pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">for </span><span style="font-family:CourierStd,serif;font-size:9.5pt">listenTo()</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt">, which we will mostly find useful in the context of Backbone views.</span></p>
</div>

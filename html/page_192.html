<div id="page0" style="position:relative;width:540pt;height:648pt;background-color:white">
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:32pt;left:209pt"><span style="font-family:Times,serif;font-size:9.963pt">Chapter 7. Multiprogramming</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:100pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">As in single-process program architectures, the simplest organization is the best. The remainder of</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:112pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">this chapter will present IPC techniques roughly in order of escalating complexity of programming</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:124pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">them.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:124pt;left:102pt"><span style="font-family:Times,serif;font-size:9.963pt">Before using a later, more complex technique, you should prove by demonstration &#x2014; with</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:136pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">prototypes and benchmark results &#x2014; that no earlier and simpler technique will do. Often you will</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:148pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">surprise yourself.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:170pt;left:72pt"><b><span style="font-family:Helvetica,sans-serif;font-size:13.948pt">Handing off Tasks to Specialist Programs</span></b></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:196pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">In the simplest form of interprogram cooperation enabled by inexpensive process spawning, a</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:208pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">program runs another to accomplish a specialized task. Because the called program is often speci&#xfb01;ed</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:219pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">as a Unix shell command through the system(3) call, this is often called</span><i><span style="font-family:Times,serif;font-size:9.963pt"> shelling out</span></i><span style="font-family:Times,serif;font-size:9.963pt"> to the called</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:231pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">program. The called program inherits the user&#x2019;s keyboard and display and runs to completion. When</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:243pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">it exits, the calling program resumes control of the keyboard and display and resumes execution.</span><sup><span style="font-family:Times,serif;font-size:6.273pt">68</span></sup></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:255pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Because the calling program does not communicate with the called program during the callee&#x2019;s</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:267pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">execution, protocol design is not an issue in this kind of cooperation, except in the trivial sense that</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:279pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">the caller may pass command-line arguments to the callee to change its behavior.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:301pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">The classic Unix case of shelling out is calling an editor from within a mail or news program. In</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:313pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">the Unix tradition one does</span><i><span style="font-family:Times,serif;font-size:9.963pt"> not</span></i><span style="font-family:Times,serif;font-size:9.963pt"> bundle purpose-built editors into programs that require general text-</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:325pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">edited input. Instead, one allows the user to specify an editor of his or her choice to be called when</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:337pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">editing needs to be done.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:358pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">The specialist program usually communicates with its parent through the &#xfb01;le system, by reading or</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:370pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">modifying &#xfb01;le(s) with speci&#xfb01;ed location(s); this is how editor or mailer shellouts work.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:392pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">In a common variant of this pattern, the specialist program may accept input on its standard input,</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:404pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">and be called with the C library entry point</span><tt><span style="font-family:Courier,monospace;font-size:8.966pt"> popen(..., &quot;w&quot;)</span></tt><span style="font-family:Times,serif;font-size:9.963pt"> or as part of a shellscript.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:404pt;left:457pt"><span style="font-family:Times,serif;font-size:9.963pt">Or</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:416pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">it may send output to its standard output, and be called with</span><tt><span style="font-family:Courier,monospace;font-size:8.966pt"> popen(..., &quot;r&quot;)</span></tt><span style="font-family:Times,serif;font-size:9.963pt"> or as part of a</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:428pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">shellscript. (If it both reads from standard input and writes to standard output, it does so in a batch</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:440pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">mode, completing all reads before doing any writes.)</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:440pt;left:301pt"><span style="font-family:Times,serif;font-size:9.963pt">This kind of child process is not usually</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:452pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">referred to as a shellout; there is no standard jargon for it, but it might well be called a &#x2018;bolt-on&#x2019;.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:473pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">They key point about all these cases is that the specialist programs don&#x2019;t handshake with the parent</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:485pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">while they are running.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:485pt;left:174pt"><span style="font-family:Times,serif;font-size:9.963pt">They have an associated protocol only in the trivial sense that whichever</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:497pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">program (master or slave) is accepting input from the other has to be able to parse it.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:526pt;left:72pt"><span style="font-family:Times,serif;font-size:5.018pt">68</span><span style="font-family:Times,serif;font-size:7.97pt">A common error in programming shellouts is to forget to block signals in the parent while the subprocess runs. Without</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:536pt;left:72pt"><span style="font-family:Times,serif;font-size:7.97pt">this precaution, an interrupt typed to the subprocess can have unwanted side effects on the parent process.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:581pt;left:262pt"><span style="font-family:Times,serif;font-size:9.963pt">191</span></p>
</div>

<div id="page0" style="position:relative;width:540pt;height:648pt;background-color:white">
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:32pt;left:227pt"><span style="font-family:Times,serif;font-size:9.963pt">Chapter 5. Textuality</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:100pt;left:72pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt">/etc/passwd</span></tt><span style="font-family:Times,serif;font-size:9.963pt"> format (one record per line, colon-separated &#xfb01;elds) is very traditional under Unix and</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:112pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">frequently used for tabular data.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:112pt;left:210pt"><span style="font-family:Times,serif;font-size:9.963pt">Other classic examples include the</span><tt><span style="font-family:Courier,monospace;font-size:8.966pt"> /etc/group</span></tt><span style="font-family:Times,serif;font-size:9.963pt"> &#xfb01;le describing</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:124pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">security groups and the</span><tt><span style="font-family:Courier,monospace;font-size:8.966pt"> /etc/inittab</span></tt><span style="font-family:Times,serif;font-size:9.963pt"> &#xfb01;le used to control startup and shutdown of Unix service</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:136pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">programs at different run levels of the operating system.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:158pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Data &#xfb01;les in this style are expected to support inclusion of colons in the data &#xfb01;elds by backslash</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:170pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">escaping.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:170pt;left:122pt"><span style="font-family:Times,serif;font-size:9.963pt">More generally, code that reads them is expected to support record continuation by</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:181pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">ignoring backslash-escaped newlines, and to allow embedding nonprintable character data by C-</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:193pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">style backslash escapes.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:215pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">This format is most appropriate when the data is tabular, keyed by a name (in the &#xfb01;rst &#xfb01;eld), and</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:227pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">records are typically short (less than 80 characters long). It works well with traditional Unix tools.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:249pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">One occasionally sees &#xfb01;eld separators other than the colon, such as the pipe character | or even an</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:261pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">ASCII NUL. Old-school Unix practice used to favor tabs, a preference re&#xfb02;ected in the defaults for</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:273pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">cut(1) and paste(1); but this has gradually changed as format designers became aware of the many</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:285pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">small irritations that ensue from the fact that tabs and spaces are not visually distinguishable.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:307pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">This format is to Unix what CSV (comma-separated value) format is under Microsoft Windows and</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:319pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">elsewhere outside the Unix world. CSV (&#xfb01;elds separated by commas, double quotes used to escape</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:331pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">commas, no continuation lines) is rarely found under Unix.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:353pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">In fact, the Microsoft version of CSV is a textbook example of how</span><i><span style="font-family:Times,serif;font-size:9.963pt"> not</span></i><span style="font-family:Times,serif;font-size:9.963pt"> to design a textual &#xfb01;le format.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:365pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Its problems begin with the case in which the separator character (in this case, a comma) is found</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:377pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">inside a &#xfb01;eld. The Unix way would be to simply escape the separator with a backslash, and have a</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:389pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">double escape represent a literal backslash.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:389pt;left:253pt"><span style="font-family:Times,serif;font-size:9.963pt">This design gives us a single special case (the escape</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:401pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">character) to check for when parsing the &#xfb01;le, and only a single action when the escape is found (treat</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:413pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">the following character as a literal). The latter conveniently not only handles the separator character,</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:425pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">but gives us a way to handle the escape character and newlines for free. CSV, on the other hand,</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:437pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">encloses the entire &#xfb01;eld in double quotes if it contains the separator.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:437pt;left:358pt"><span style="font-family:Times,serif;font-size:9.963pt">If the &#xfb01;eld contains double</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:448pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">quotes, it must also be enclosed in double quotes, and the individual double quotes in the &#xfb01;eld must</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:460pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">themselves be repeated twice to indicate that they don&#x2019;t end the &#xfb01;eld.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:482pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">The bad results of proliferating special cases are twofold.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:482pt;left:323pt"><span style="font-family:Times,serif;font-size:9.963pt">First, the complexity of the parser</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:494pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">(and its vulnerability to bugs) is increased.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:494pt;left:260pt"><span style="font-family:Times,serif;font-size:9.963pt">Second, because the format rules are complex and</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:506pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">underspeci&#xfb01;ed, different implementations diverge in their handling of edge cases.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:506pt;left:423pt"><span style="font-family:Times,serif;font-size:9.963pt">Sometimes</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:518pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">continuation lines</span><i><span style="font-family:Times,serif;font-size:9.963pt"> are</span></i><span style="font-family:Times,serif;font-size:9.963pt"> supported, by starting the last &#xfb01;eld of the line with an unterminated double</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:530pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">quote &#x2014; but only in some products! Microsoft has incompatible versions of CSV &#xfb01;les between its</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:581pt;left:262pt"><span style="font-family:Times,serif;font-size:9.963pt">138</span></p>
</div>

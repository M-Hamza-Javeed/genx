<div id="page0" style="position:relative;width:540pt;height:648pt;background-color:white">
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:32pt;left:218pt"><span style="font-family:Times,serif;font-size:9.963pt">Chapter 8. Minilanguages</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:100pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">If there is any way that your application&#x2019;s users might end up running programs from untrusted</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:112pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">sources, risky features of your application minilanguage might end up having to be suppressed.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:124pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Languages like Java and JavaScript are explicitly</span><i><span style="font-family:Times,serif;font-size:9.963pt"> sandboxed</span></i><span style="font-family:Times,serif;font-size:9.963pt">&#x2014;that is, they have limited access to</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:136pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">their environment not merely to simplify their design but to try to prevent potentially destructive</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:148pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">operations by buggy or malicious code.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:170pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">On the other hand, a lot of bad designs have been botched by designers who failed to face up to the</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:181pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">fact that they really needed a minilanguage rather than a data-&#xfb01;le format. Too often, language-like</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:193pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">features get pasted on as an afterthought. The two most common symptoms of this problem are</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:205pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">weak, ad-hoc control structures and poor or nonexistent facilities for declaring procedures.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:227pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">It&#x2019;s risky to design minilanguages that are only accidentally Turing-complete.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:227pt;left:397pt"><span style="font-family:Times,serif;font-size:9.963pt">If you do this the</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:239pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">odds are good that, sometime in the future, some clever fellow is going to think he needs to press</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:251pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">your language into doing loops and conditionals for him.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:251pt;left:313pt"><span style="font-family:Times,serif;font-size:9.963pt">Because these are only available in an</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:263pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">obfuscated way, he&#x2019;ll produce obfuscated code. The results may be serviceable in the short term,</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:275pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">but are likely to be a nightmare for those who come after him.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:297pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Minilanguage design is both powerful and esthetically rewarding, but it&#x2019;s also full of similar traps.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:309pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">There are kinds of design in which it is appropriate to take the bottom-up approach of pasting</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:321pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">together a bunch of low-level services and worrying about their organization after you have explored</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:333pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">the problem domain for a while. One of the virtues of minilanguages is that they can help you get a</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:345pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">good design out of bottom-up programming by allowing you to defer some top-down decisions into</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:357pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">the control &#xfb02;ow of programs in your minilanguage.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:357pt;left:289pt"><span style="font-family:Times,serif;font-size:9.963pt">But if you take a bottom-up approach to the</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:369pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">minilanguage design</span><i><span style="font-family:Times,serif;font-size:9.963pt"> itself</span></i><span style="font-family:Times,serif;font-size:9.963pt">, you are likely to end up with an ugly syntax re&#xfb02;ecting a weak language</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:381pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">and a poorly-thought-out implementation.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:403pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">There are many places in a minilanguage design where small choices make a large difference in the</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:415pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">useability and ease of the tool:</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:437pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">As a language designer, it is a good principle to consider the alternatives to giving</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:448pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">an error message. When there is true ambiguity in the intent of the programmer</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:460pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">an error message is appropriate, but in many cases the intent is clear, and making</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:472pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">the language silently do the right thing is a great boon.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:472pt;left:353pt"><span style="font-family:Times,serif;font-size:9.963pt">A good example is</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:484pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">C accommodating an extra comma at the end of an array initializer list, which</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:496pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">makes both editing and machine generation of array initializers much easier. Anti-</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:508pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">examples are the pickiness of various HTML readers, especially their habit of</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:520pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">silently discarding parts of your document because of trivial nesting errors.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:532pt;left:422pt"><span style="font-family:Times,serif;font-size:9.963pt">&#x2014;</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:581pt;left:262pt"><span style="font-family:Times,serif;font-size:9.963pt">243</span></p>
</div>

<div id="page0" style="position:relative;width:540pt;height:648pt;background-color:white">
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:32pt;left:219pt"><span style="font-family:Times,serif;font-size:9.963pt">Chapter 12. Optimization</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:100pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">an obvious speed optimization. Nowadays it may be faster to recompute each time rather than pay</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:112pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">for the percentage of additional cache misses caused by the table.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:134pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">But in the future, this might turn around again as caches grow larger.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:134pt;left:377pt"><span style="font-family:Times,serif;font-size:9.963pt">More generally, many</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:146pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">optimizations are temporary and can easily turn into pessimizations as cost ratios change. The only</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:158pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">way to know is to measure and see.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:180pt;left:72pt"><b><span style="font-family:Helvetica,sans-serif;font-size:15.94pt">Throughput vs. Latency</span></b></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:209pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Another effect of fast processors is that performance is usually bounded by the cost of I/O and &#x2014;</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:221pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">especially with programs that use the Internet &#x2014; network transactions.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:221pt;left:368pt"><span style="font-family:Times,serif;font-size:9.963pt">It&#x2019;s therefore valuable to</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:232pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">know how to design network protocols for good performance.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:254pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">The most important issue is avoiding protocol round trips as much as possible.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:254pt;left:407pt"><span style="font-family:Times,serif;font-size:9.963pt">Every protocol</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:266pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">transaction that requires a handshake turns any latency in the connection into a potentially serious</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:278pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">slowdown. Avoiding such handshakes is not speci&#xfb01;cally a Unix-tradition practice, but it&#x2019;s one that</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:290pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">needs mention here because so many protocol designs lose huge amounts of performance to them.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:312pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">I cannot say enough about latency.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:312pt;left:266pt"><span style="font-family:Times,serif;font-size:9.963pt">X11 went well beyond X10 in avoiding</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:324pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">round trip requests: the Render extension goes even further.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:324pt;left:357pt"><span style="font-family:Times,serif;font-size:9.963pt">X (and these days,</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:336pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">HTTP/1.1) is a streaming protocol.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:336pt;left:261pt"><span style="font-family:Times,serif;font-size:9.963pt">For example, on my laptop, I can execute</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:348pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">over 4</span><i><span style="font-family:Times,serif;font-size:9.963pt"> million</span></i><span style="font-family:Times,serif;font-size:9.963pt"> 1&#xd7;1 rectangle requests (8 million no-op requests) per second. But</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:360pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">round trips are hundreds or thousands of times more expensive. Anytime you</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:372pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">can get a client to do something without having to contact the server, you have a</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:384pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">tremendous win.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:396pt;left:422pt"><span style="font-family:Times,serif;font-size:9.963pt">&#x2014;</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:408pt;left:315pt"><span style="font-family:Times,serif;font-size:9.963pt;color:#ff0000">&lt;author&gt;JimGettys&lt;/author&gt;</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:430pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">In fact, a good rule of thumb is to design for the lowest possible latency and ignore bandwidth costs</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:442pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">until your pro&#xfb01;ling tells you otherwise.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:442pt;left:240pt"><span style="font-family:Times,serif;font-size:9.963pt">Bandwidth problems can be solved later in development</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:454pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">by tricks like compressing a protocol stream on the &#xfb02;y; but getting rid of high latency baked into an</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:466pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">existing design is much, much harder (often, effectively impossible).</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:488pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">While this effect shows up most clearly in network protocol design, throughput vs. latency tradeoffs</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:499pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">are a much more general phenomenon.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:499pt;left:237pt"><span style="font-family:Times,serif;font-size:9.963pt">In writing applications, you will sometimes face a choice</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:511pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">between doing an expensive computation once in anticipation that it will be used several times, or</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:523pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">computing only when actually needed (even if that means you will often recompute results).</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:523pt;left:459pt"><span style="font-family:Times,serif;font-size:9.963pt">In</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:535pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">most cases where you face a tradeoff like this, the right thing to do is bias toward low latency. That</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:581pt;left:262pt"><span style="font-family:Times,serif;font-size:9.963pt">331</span></p>
</div>

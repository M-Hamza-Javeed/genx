<div id="page0" style="position:relative;width:540pt;height:648pt;background-color:white">
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:32pt;left:227pt"><span style="font-family:Times,serif;font-size:9.963pt">Chapter 5. Textuality</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:100pt;left:81pt"><span style="font-family:Times,serif;font-size:9.963pt">&#x2022;</span><i><span style="font-family:Times,serif;font-size:9.963pt"> In stanza formats, support line continuation.</span></i><span style="font-family:Times,serif;font-size:9.963pt"> When interpreting the &#xfb01;le, either discard backslash</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:112pt;left:86pt"><span style="font-family:Times,serif;font-size:9.963pt">followed by whitespace or interpret newline followed by whitespace equivalently to a single</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:124pt;left:86pt"><span style="font-family:Times,serif;font-size:9.963pt">space, so that a long logical line can be folded into short (easily editable!) physical lines. It&#x2019;s</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:136pt;left:86pt"><span style="font-family:Times,serif;font-size:9.963pt">also conventional to ignore trailing whitespace in these formats; this convention protects against</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:148pt;left:86pt"><span style="font-family:Times,serif;font-size:9.963pt">common editor bobbles.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:170pt;left:81pt"><span style="font-family:Times,serif;font-size:9.963pt">&#x2022;</span><i><span style="font-family:Times,serif;font-size:9.963pt"> Either include a version number or design the format as self-describing chunks independent of</span></i></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:181pt;left:86pt"><i><span style="font-family:Times,serif;font-size:9.963pt">each other.</span></i><span style="font-family:Times,serif;font-size:9.963pt"> If there is even the faintest possibility that the format will have to be changed or</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:193pt;left:86pt"><span style="font-family:Times,serif;font-size:9.963pt">extended, include a version number so your code can conditionally do the right thing on all</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:205pt;left:86pt"><span style="font-family:Times,serif;font-size:9.963pt">versions.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:205pt;left:132pt"><span style="font-family:Times,serif;font-size:9.963pt">Alternatively, design the format as self-describing chunks so that you can add new</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:217pt;left:86pt"><span style="font-family:Times,serif;font-size:9.963pt">chunk types without instantly breaking old code.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:239pt;left:81pt"><span style="font-family:Times,serif;font-size:9.963pt">&#x2022;</span><i><span style="font-family:Times,serif;font-size:9.963pt"> Beware of &#xfb02;oating-point round-off problems.</span></i><span style="font-family:Times,serif;font-size:9.963pt"> Conversion of &#xfb02;oating-point numbers from binary</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:251pt;left:86pt"><span style="font-family:Times,serif;font-size:9.963pt">to text format and back can lose precision, depending on the quality of the conversion library you</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:263pt;left:86pt"><span style="font-family:Times,serif;font-size:9.963pt">are using. If the structure you are marshaling/unmarshaling contains &#xfb02;oating point, you should</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:275pt;left:86pt"><span style="font-family:Times,serif;font-size:9.963pt">test the conversion in both directions.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:275pt;left:248pt"><span style="font-family:Times,serif;font-size:9.963pt">If it looks like conversion in either direction is subject</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:287pt;left:86pt"><span style="font-family:Times,serif;font-size:9.963pt">to roundoff errors, be prepared to dump the &#xfb02;oating-point &#xfb01;eld as raw binary instead, or a string</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:299pt;left:86pt"><span style="font-family:Times,serif;font-size:9.963pt">encoding thereof. If you&#x2019;re coding in C or some language that has access to C printf/scanf, the</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:311pt;left:86pt"><span style="font-family:Times,serif;font-size:9.963pt">C99</span><tt><span style="font-family:Courier,monospace;font-size:8.966pt"> %a</span></tt><span style="font-family:Times,serif;font-size:9.963pt"> speci&#xfb01;er may solve this problem.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:333pt;left:81pt"><span style="font-family:Times,serif;font-size:9.963pt">&#x2022;</span><i><span style="font-family:Times,serif;font-size:9.963pt"> Don&#x2019;t bother compressing or binary-encoding just part of the &#xfb01;le.</span></i><span style="font-family:Times,serif;font-size:9.963pt"> See below...</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:367pt;left:72pt"><b><span style="font-family:Helvetica,sans-serif;font-size:13.948pt">The Pros and Cons of File Compression</span></b></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:393pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Many modern Unix projects, such as OpenOf&#xfb01;ce.org and AbiWord, now use XML compressed with</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:405pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">zip(1) or gzip(1) as a data &#xfb01;le format.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:405pt;left:232pt"><span style="font-family:Times,serif;font-size:9.963pt">Compressed XML combines space economy with some of</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:417pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">the advantages of a textual format &#x2014; notably, it avoids the problem that binary formats must often</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:429pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">allocate space for information that may not be used in particular cases (e.g., for unusual options or</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:441pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">large ranges).</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:441pt;left:138pt"><span style="font-family:Times,serif;font-size:9.963pt">But there is some dispute about this, dispute which turns on some of the central</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:453pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">tradeoffs discussed in this chapter.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:475pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">On the one hand, experiments have shown that documents in a compressed XML &#xfb01;le are usually</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:487pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">signi&#xfb01;cantly smaller than the Microsoft Word&#x2019;s native &#xfb01;le format, a binary format that one might</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:499pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">imagine would take less space.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:499pt;left:206pt"><span style="font-family:Times,serif;font-size:9.963pt">The reason relates to a fundamental of the Unix philosophy: Do</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:511pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">one thing well.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:511pt;left:143pt"><span style="font-family:Times,serif;font-size:9.963pt">Creating a single tool to do the compression job well is more effective than ad-</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:523pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">hoc compression on parts of the &#xfb01;le, because the tool can look across all the data and exploit</span><i><span style="font-family:Times,serif;font-size:9.963pt"> all</span></i></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:535pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">repetition in the information.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:581pt;left:262pt"><span style="font-family:Times,serif;font-size:9.963pt">147</span></p>
</div>

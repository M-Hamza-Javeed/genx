<div id="page0" style="position:relative;width:612pt;height:792pt;background-color:white">
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:95pt;left:108pt"><i><span style="font-family:BookAntiqua,serif;font-size:9pt">Unit Test, Stub, Spy, and Mock Your App</span></i></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:666pt;left:293pt"><b><span style="font-family:Arial,sans-serif;font-size:9pt">[</span></b><b><span style="font-family:Arial,sans-serif;font-size:8pt"> 132 </span></b><b><span style="font-family:Arial,sans-serif;font-size:9pt">]</span></b></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:115pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">    return this.get(&apos;name&apos;).split(&apos; &apos;);</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:127pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  }</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:139pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">});</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:164pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">test(&apos;should call getNameAsArray and return an array&apos;, </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:175pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">   function () {</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:187pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  this.user = new User({</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:199pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">    name: &apos;Krishnendu Saha&apos;</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:211pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  });</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:236pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  // Added a spy on the the &quot;getNameAsArray&quot; method</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:248pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  sinon.spy(this.user, &apos;getNameAsArray&apos;); // or this.spy()</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:260pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  this.user.getNameAsArray();</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:285pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  // We check whether the method is called only once</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:297pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  ok(this.user.getNameAsArray.calledOnce);</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:321pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  // We check whether the returned value of this </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:334pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  // method is an array</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:346pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  equal(_.isArray(this.user.getNameAsArray.returnValues[0]), </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:357pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">   true);</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:369pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">});</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:388pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">We used the same </span><span style="font-family:CourierStd,serif;font-size:9.5pt">User</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt"> model and added a </span><span style="font-family:CourierStd,serif;font-size:9.5pt">getNameAsArray()</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt"> method to it. We </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:401pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">spied on this method to test whether it gets called only once and returns an array. </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:413pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">The previous test case passes fine.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:435pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">So, you can use spies for any or all of the following cases:</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:456pt;left:126pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">&#x2022; </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:456pt;left:143pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">Check for the invocation of a callback</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:473pt;left:126pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">&#x2022; </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:473pt;left:143pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">Validate whether callbacks are executed with certain arguments</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:490pt;left:126pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">&#x2022; </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:490pt;left:143pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">Validate if internal functions provide the correct return value</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:507pt;left:126pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">&#x2022; </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:507pt;left:143pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">Validate a certain simple calling behavior</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:537pt;left:108pt"><b><span style="font-family:Arial,sans-serif;font-size:18pt">Testing with stubs</span></b></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:560pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">A test stub, on the other hand, extends from a spy and adds some extra functionality </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:572pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">to it. It is a function with preprogramed behavior and supports the complete </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:585pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">spy API. It is used to replace (or fake) the behavior of an existing method with </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:597pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">something. It is quite useful when you want to prevent a specific method from being </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:610pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">called directly, or force a method to throw an error in order to test error handling. </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:623pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">Like spies, stubs can either be anonymous, or they can wrap the existing functions. </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:635pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">When wrapping an existing function with a stub, the original function is not called.</span></p>
</div>

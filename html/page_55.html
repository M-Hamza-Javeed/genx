<div id="page0" style="position:relative;width:612pt;height:792pt;background-color:white">
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:95pt;left:468pt"><i><span style="font-family:BookAntiqua,serif;font-size:9pt">Chapter 2</span></i></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:666pt;left:295pt"><b><span style="font-family:Arial,sans-serif;font-size:9pt">[</span></b><b><span style="font-family:Arial,sans-serif;font-size:8pt"> 39 </span></b><b><span style="font-family:Arial,sans-serif;font-size:9pt">]</span></b></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:115pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">For a large application, you may not want to store your templates in this way </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:127pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">inside a JavaScript file, where you will not get any facility to format and highlight </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:140pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">the HTML code. However, the usefulness of this pattern cannot be denied, more </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:153pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">so when we get a single JavaScript file with a minified set of all the precompiled </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:165pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">templates. In </span><i><span style="font-family:BookAntiqua,serif;font-size:10.5pt">Appendix B</span></i><span style="font-family:BookAntiqua,serif;font-size:10.5pt">, </span><i><span style="font-family:BookAntiqua,serif;font-size:10.5pt">Precompiling Templates on the Server Side</span></i><span style="font-family:BookAntiqua,serif;font-size:10.5pt">, we discuss this </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:178pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">process in detail.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:199pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">With the popularity of Require.js and </span><b><span style="font-family:BookAntiqua,serif;font-size:10.5pt">Asynchronous Module Definition</span></b><span style="font-family:BookAntiqua,serif;font-size:10.5pt"> (</span><b><span style="font-family:BookAntiqua,serif;font-size:10.5pt">AMD</span></b><span style="font-family:BookAntiqua,serif;font-size:10.5pt">), </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:212pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">most developers today prefer storing individual templates in a separate template or </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:224pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">in HTML files. Later, when the complete project&apos;s source code is optimized, it creates </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:237pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">a single minified file with all the templates merged in JavaScript. This technique is </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:249pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">now a popular approach, and we explained the functionality in detail in </span><i><span style="font-family:BookAntiqua,serif;font-size:10.5pt">Appendix C</span></i><span style="font-family:BookAntiqua,serif;font-size:10.5pt">, </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:262pt;left:108pt"><i><span style="font-family:BookAntiqua,serif;font-size:10.5pt">Organizing Templates with AMD and Require.js</span></i><span style="font-family:BookAntiqua,serif;font-size:10.5pt">.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:293pt;left:108pt"><b><span style="font-family:Arial,sans-serif;font-size:18pt">Precompiling templates</span></b></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:315pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">What is</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt"> template compilation? In general, we </span><span style="font-family:BookAntiqua,serif;font-size:10.5pt">create templates as strings and include </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:328pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">template expressions in them. Once we pass that string for compilation, the template </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:340pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">library analyze the string to create a format which can be applied with the data. This </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:353pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">compiled function then returns another function where we pass the data and get the </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:365pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">data integrated HTML string in return. This process is called template compilation.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:387pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">Why do we need to precompile a template? This is because when we use a </span><span style="font-family:BookAntiqua,serif;font-size:10.5pt"> </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:399pt;left:108pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">template string, say </span><span style="font-family:CourierStd,serif;font-size:9.5pt">TplManager.templates.userProfile</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt">, multiple times, the </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:412pt;left:107pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">same compilation process gets repeated every time. This is clearly extra work that </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:424pt;left:107pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">will affect the performance of the app significantly. You can compare the difference </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:437pt;left:107pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">in this jsperf test (</span><span style="font-family:CourierStd,serif;font-size:9.5pt">http://jsperf.com/underscore-templates-classic-vs-</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:450pt;left:108pt"><span style="font-family:CourierStd,serif;font-size:9.5pt">precompiled</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt">) performed by Igor Hlina (</span><span style="font-family:CourierStd,serif;font-size:9.5pt">https://twitter.com/srigi</span><span style="font-family:BookAntiqua,serif;font-size:10.5pt">). The test </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:462pt;left:107pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">shows that the precompilation of a template yields a 99 percent faster result than the </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:475pt;left:107pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">classic approach.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:496pt;left:107pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">By precompiling templates and caching them, you can reduce the overhead to a large </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:509pt;left:107pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">extent. Let&apos;s add a method to our template manager that will compile a template only </span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:521pt;left:107pt"><span style="font-family:BookAntiqua,serif;font-size:10.5pt">once and return the cached version every time:</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:543pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">var TplManager = {</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:555pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  templates: {},</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:567pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  cachedTemplates: {},</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:592pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  // Returns compiled template</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:604pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">  getCachedTemplate: function (tplName) {</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:616pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">    // If compiled template already exists, return that</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:628pt;left:126pt"><span style="font-family:CourierStd,serif;font-size:9pt">    if (this.cachedTemplates.hasOwnProperty(tplName)) {</span></p>
</div>

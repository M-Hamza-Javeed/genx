<div id="page0" style="position:relative;width:540pt;height:648pt;background-color:white">
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:32pt;left:221pt"><span style="font-family:Times,serif;font-size:9.963pt">Chapter 6. Transparency</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:100pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">primarily as documentation.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:100pt;left:199pt"><span style="font-family:Times,serif;font-size:9.963pt">Thus, the synchronization and inconsistency problems that would</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:112pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">normally militate against this approach almost never arise.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:134pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">The designers of terminfo could have optimized for speed in a second way. The entire database of</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:146pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">binary entries could have been put in some kind of big opaque database &#xfb01;le. What they actually did</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:158pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">instead was more clever and more in the Unix spirit. Terminfo entries live in a directory hierarchy,</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:170pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">usually on modern Unixes under</span><tt><span style="font-family:Courier,monospace;font-size:8.966pt"> /usr/share/terminfo</span></tt><span style="font-family:Times,serif;font-size:9.963pt">.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:170pt;left:320pt"><span style="font-family:Times,serif;font-size:9.963pt">Consult the terminfo(5) man page to</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:181pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">&#xfb01;nd the location on your system.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:203pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">If you look in the terminfo directory, you&#x2019;ll see subdirectories named by single printable characters.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:215pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Under each of these are the entries for each terminal type that has a name beginning with that letter.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:227pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">The goal of this organization was to avoid having to do a linear search of a very large directory;</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:239pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">under more modern Unix &#xfb01;le systems, which represent directories with B-trees or other structures</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:251pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">optimized for fast lookup, the subdirectories won&#x2019;t be necessary.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:273pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">I found that even on a fairly modern Unix, splitting a big directory up into</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:285pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">subdirectories can improve performance substantially.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:285pt;left:334pt"><span style="font-family:Times,serif;font-size:9.963pt">It was tens of thousands</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:297pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">of &#xfb01;les, an authorized-user database for a big educational institution, on a late-</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:309pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">model DEC Alpha running DEC&#x2019;s Unix. (Subdirectories named by &#xfb01;rst and last</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:321pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">letter of name &#x2014; e.g., &quot;johnson&quot; would be in directory &quot;j_n&quot; &#x2014; worked best of</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:333pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">the schemes we tested. Using the &#xfb01;rst two letters wasn&#x2019;t nearly as good, because</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:345pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">there were a lot of systematically-generated names which differed only toward</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:357pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">the end.) This may just say that sophisticated directory indexing is still not as</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:369pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">common as it should be... but even so, that makes an organization which works</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:381pt;left:108pt"><span style="font-family:Times,serif;font-size:9.963pt">well without it more portable than one which requires it.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:393pt;left:422pt"><span style="font-family:Times,serif;font-size:9.963pt">&#x2014;</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:405pt;left:298pt"><span style="font-family:Times,serif;font-size:9.963pt;color:#ff0000">&lt;author&gt;HenrySpencer&lt;/author&gt;</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:427pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Thus, the cost of opening a terminfo entry is two &#xfb01;le system lookups and a &#xfb01;le open.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:427pt;left:453pt"><span style="font-family:Times,serif;font-size:9.963pt">But</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:439pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">since mining the same entry from one big database would have required a lookup and open for</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:450pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">the database, the incremental cost for terminfo&#x2019;s organization is at most one &#xfb01;le system lookup.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:462pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Actually, it&#x2019;s less than that; it&#x2019;s the cost difference between one &#xfb01;le system lookup and whatever</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:474pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">retrieval method the one big database would have used.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:474pt;left:316pt"><span style="font-family:Times,serif;font-size:9.963pt">This is probably marginal, and quite</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:486pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">tolerable once per application at startup time.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:508pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Terminfo uses the &#xfb01;le system itself as a simple hierarchical database.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:508pt;left:374pt"><span style="font-family:Times,serif;font-size:9.963pt">This is a superb bit of</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:520pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">constructive laziness, obeying the Rule of Economy and the Rule of Transparency. It means that all</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:532pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">the ordinary tools for navigating, examining and modifying the &#xfb01;le system can be used to navigate,</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:581pt;left:262pt"><span style="font-family:Times,serif;font-size:9.963pt">175</span></p>
</div>

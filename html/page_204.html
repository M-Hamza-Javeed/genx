<div id="page0" style="position:relative;width:540pt;height:648pt;background-color:white">
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:32pt;left:209pt"><span style="font-family:Times,serif;font-size:9.963pt">Chapter 7. Multiprogramming</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:100pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">nonresetting entry points for new code, but program defensively in case your code is ever ported to</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:112pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">an implementation that does not support them.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:134pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Receiving N signals does not necessarily invoke the signal handler N times. Under the older System</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:146pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">V signal model, two or more signals spaced very closely together (that is, within a single timeslice of</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:154pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">the target process) can result in various race conditions</span><sup><span style="font-family:Times,serif;font-size:6.273pt">75</span></sup><sup><span style="font-family:Times,serif;font-size:9.963pt"> </span></sup><span style="font-family:Times,serif;font-size:9.963pt">or anomalies. Depending on what variant</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:170pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">of signals semantics the system supports, the second and later instances may be ignored, may cause</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:181pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">an unexpected process kill, or may have their delivery delayed until earlier instances have been</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:193pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">processed (on modern Unixes the last is most likely).</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:215pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">The modern signals API is portable across all recent Unix versions, but not to Windows or classic</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:227pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">(pre-OS X) MacOS.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:249pt;left:72pt"><b><span style="font-family:Helvetica,sans-serif;font-size:11.955pt">System Daemons and Conventional Signals</span></b></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:274pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">Many well-known system daemons accept</span><tt><span style="font-family:Courier,monospace;font-size:8.966pt"> SIGHUP</span></tt><span style="font-family:Times,serif;font-size:9.963pt"> (originally the signal sent to programs on a</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:285pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">serial-line drop, such as was produced by hanging up a modem connection) as a signal to reinitialize</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:297pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">(that is, reload their con&#xfb01;guration &#xfb01;les); examples include Apache and the Linux implementations of</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:309pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">bootpd(8), gated(8), inetd(8), mountd(8), named(8), nfsd(8), and ypbind(8). In a few cases,</span><tt><span style="font-family:Courier,monospace;font-size:8.966pt"> SIGHUP</span></tt></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:321pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">is accepted in its original sense of a session-shutdown signal (notably in Linux pppd(8)), but that</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:333pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">role nowadays generally goes to</span><tt><span style="font-family:Courier,monospace;font-size:8.966pt"> SIGTERM</span></tt><span style="font-family:Times,serif;font-size:9.963pt">.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:355pt;left:72pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt">SIGTERM</span></tt><span style="font-family:Times,serif;font-size:9.963pt"> (&#x2018;terminate&#x2019;) is often accepted as a graceful-shutdown signal (this is as distinct from</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:367pt;left:72pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt">SIGKILL</span></tt><span style="font-family:Times,serif;font-size:9.963pt">, which does an immediate process kill and cannot be blocked or handled).</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:369pt;left:430pt"><tt><span style="font-family:Courier,monospace;font-size:8.966pt">SIGTERM</span></tt></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:379pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">actions often involve cleaning up temp&#xfb01;les, &#xfb02;ushing &#xfb01;nal updates out to databases, and the like.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:401pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">When writing daemons, follow the Rule of Least Surprise: use these conventions, and read the</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:413pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">manual pages to look for existing models.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:435pt;left:72pt"><b><span style="font-family:Helvetica,sans-serif;font-size:11.955pt">Case Study:</span></b><b><i><span style="font-family:Helvetica,sans-serif;font-size:11.955pt"> fetchmail&#x2019;s</span></i></b><b><span style="font-family:Helvetica,sans-serif;font-size:11.955pt"> Use of Signals</span></b></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:459pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">The</span><i><span style="font-family:Times,serif;font-size:9.963pt"> fetchmail</span></i><span style="font-family:Times,serif;font-size:9.963pt"> utility is normally set up to run as a daemon in background, periodically collecting</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:471pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">mail from all remote sites de&#xfb01;ned in its run-control &#xfb01;le and passing the mail to the local SMTP</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:483pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">listener on port 25 without user intervention.</span><i><span style="font-family:Times,serif;font-size:9.963pt"> fetchmail</span></i><span style="font-family:Times,serif;font-size:9.963pt"> sleeps for a user-de&#xfb01;ned interval (defaulting</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:495pt;left:72pt"><span style="font-family:Times,serif;font-size:9.963pt">to 15 minutes) between collection attempts, so as to avoid constantly loading the network.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:515pt;left:72pt"><span style="font-family:Times,serif;font-size:5.018pt">75</span><span style="font-family:Times,serif;font-size:7.97pt">A &#x2018;race condition&#x2019; is a class of problem in which correct behavior of the system relies on two independent events happening</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:524pt;left:72pt"><span style="font-family:Times,serif;font-size:7.97pt">in the right order, but there is no mechanism for ensuring that they actually will. Race conditions produce intermittent,</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:534pt;left:72pt"><span style="font-family:Times,serif;font-size:7.97pt">timing-dependent problems that can be devilishly dif&#xfb01;cult to debug.</span></p>
<p style="position:absolute;white-space:pre;margin:0;padding:0;top:581pt;left:262pt"><span style="font-family:Times,serif;font-size:9.963pt">203</span></p>
</div>
